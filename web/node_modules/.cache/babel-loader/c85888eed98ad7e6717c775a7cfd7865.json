{"ast":null,"code":"import _classCallCheck from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/user/Documents/projects/hollaex/src/containers/Verification/MobileVerification.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { reduxForm, formValueSelector, SubmissionError, stopSubmit } from 'redux-form';\nimport { isMobile } from 'react-device-detect';\nimport { required } from '../../components/Form/validations';\nimport renderFields from '../../components/Form/factoryFields';\nimport { Button, IconTitle, ElapsedTimer, HeaderSection } from '../../components';\nimport STRINGS from '../../config/localizedStrings';\nimport { PHONE_OPTIONS } from '../../utils/countries';\nimport { ICONS } from '../../config/constants';\nimport { getErrorLocalized } from '../../utils/errors';\nimport { verifySmsCode, requestSmsCode } from '../../actions/verificationActions';\nvar FORM_NAME = 'MobileVerification';\nvar loadingTimeOut = '';\n\nvar MobileVerification =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(MobileVerification, _Component);\n\n  function MobileVerification() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, MobileVerification);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(MobileVerification)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      formFields: {},\n      codeRequested: false,\n      codeRequestLoading: false,\n      isLoadingTimeUp: false,\n      isTimer: false\n    };\n\n    _this.generateFormFields = function () {\n      var codeRequested = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      var loading = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var formFields = {\n        phone_country: {\n          type: 'autocomplete',\n          label: STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.PHONE_CODE_LABEL,\n          placeholder: STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.PHONE_CODE_PLACEHOLDER,\n          options: PHONE_OPTIONS,\n          validate: [required],\n          fullWidth: isMobile\n        },\n        phone_number: {\n          type: 'text',\n          label: STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.PHONE_NUMBER_LABEL,\n          placeholder: STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.PHONE_NUMBER_PLACEHOLDER,\n          validate: [required],\n          // TODO ^\\+?[1-9]\\d{1,14}$\n          notification: {\n            text: loading ? STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.CONNECTING_LOADING : STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.SMS_SEND,\n            status: loading ? 'loading' : 'information',\n            iconPath: loading ? ICONS.CONNECT_LOADING : ICONS.BLUE_ARROW_RIGHT,\n            useSvg: loading ? true : false,\n            className: 'file_upload_icon',\n            onClick: loading ? function () {} : _this.handleSendSmsCode\n          },\n          fullWidth: isMobile\n        },\n        code: {\n          type: 'text',\n          label: STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.SMS_CODE_LABEL,\n          placeholder: STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.SMS_CODE_PLACEHOLDER,\n          disabled: !codeRequested,\n          validate: [required],\n          fullWidth: isMobile\n        }\n      };\n\n      _this.setState({\n        formFields: formFields\n      });\n    };\n\n    _this.handleSubmit = function (_ref) {\n      var phone_number = _ref.phone_number,\n          phone_country = _ref.phone_country,\n          code = _ref.code;\n\n      if (!_this.state.codeRequested) {\n        throw new SubmissionError({\n          _error: 'Request sms code'\n        });\n      }\n\n      var values = {\n        phone: \"\".concat(phone_country).concat(phone_number),\n        code: code\n      };\n      return verifySmsCode(values).then(function (_ref2) {\n        var data = _ref2.data;\n\n        _this.props.moveToNextStep('mobile', values);\n\n        _this.props.setActivePageContent(0);\n      }).catch(function (err) {\n        var error = {\n          _error: err.message\n        };\n\n        if (err.response && err.response.data) {\n          error._error = err.response.data.message;\n        }\n\n        throw new SubmissionError(error);\n      });\n    };\n\n    _this.handleSendSmsCode = function () {\n      var _this$props = _this.props,\n          phone_number = _this$props.phone_number,\n          phone_country = _this$props.phone_country;\n\n      if (phone_country && phone_number) {\n        var phone = \"\".concat(phone_country, \" \").concat(phone_number);\n\n        _this.setState({\n          codeRequestLoading: true,\n          codeRequested: false,\n          isLoadingTimeUp: false\n        }, function () {\n          _this.generateFormFields(false, true);\n\n          _this.checkLoadingTime();\n        });\n\n        requestSmsCode(phone).then(function (_ref3) {\n          var data = _ref3.data;\n\n          // alert(STRINGS.formatString(STRINGS.SMS_SENT_TO, phone).join(''));\n          _this.setState({\n            codeRequested: true,\n            codeRequestLoading: false,\n            isTimer: _this.state.isLoadingTimeUp\n          }, function () {\n            var loading = _this.state.isLoadingTimeUp ? false : true;\n\n            _this.generateFormFields(true, loading);\n          });\n        }).catch(function (err) {\n          var error = {\n            _error: STRINGS.formatString(STRINGS.SMS_ERROR_SENT_TO, phone).join('')\n          };\n\n          _this.setState({\n            codeRequestLoading: false\n          }, function () {\n            _this.generateFormFields();\n          });\n\n          _this.props.dispatch(stopSubmit(FORM_NAME, error));\n        });\n      }\n    };\n\n    _this.onGoBack = function () {\n      _this.props.setActivePageContent(0);\n\n      _this.props.setActiveTab(3);\n    };\n\n    _this.checkLoadingTime = function () {\n      loadingTimeOut = setTimeout(function () {\n        var isTimer = false;\n\n        if (_this.state.codeRequested) {\n          _this.generateFormFields(true, false);\n\n          isTimer = true;\n        }\n\n        _this.setState({\n          isLoadingTimeUp: true,\n          isTimer: isTimer\n        });\n      }, 3000);\n    };\n\n    _this.onClearTimer = function () {\n      _this.setState({\n        isTimer: false,\n        codeRequested: false\n      }, function () {\n        _this.generateFormFields();\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(MobileVerification, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.generateFormFields();\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.activeLanguage !== this.props.activeLanguage) {\n        this.generateFormFields();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (loadingTimeOut) {\n        clearTimeout(loadingTimeOut);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props2 = this.props,\n          handleSubmit = _this$props2.handleSubmit,\n          pristine = _this$props2.pristine,\n          submitting = _this$props2.submitting,\n          valid = _this$props2.valid,\n          error = _this$props2.error,\n          openContactForm = _this$props2.openContactForm;\n      var _this$state = this.state,\n          formFields = _this$state.formFields,\n          codeRequested = _this$state.codeRequested,\n          isTimer = _this$state.isTimer;\n      return React.createElement(\"div\", {\n        className: \"presentation_container apply_rtl verification_container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, React.createElement(IconTitle, {\n        text: STRINGS.USER_VERIFICATION.PHONE_VERIFICATION,\n        textType: \"title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }), React.createElement(\"form\", {\n        className: \"d-flex flex-column w-100 verification_content-form-wrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, React.createElement(HeaderSection, {\n        title: STRINGS.USER_VERIFICATION.PHONE_DETAILS,\n        openContactForm: openContactForm,\n        icon: ICONS.VERIFICATION_PHONE_NEW,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.INFORMATION.PHONE_VERIFICATION_TXT), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.INFORMATION.PHONE_VERIFICATION_TXT_1), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.INFORMATION.PHONE_VERIFICATION_TXT_2)), renderFields(formFields), React.createElement(ElapsedTimer, {\n        timerText: STRINGS.USER_VERIFICATION.CODE_EXPIRES_IN,\n        isLoading: isTimer,\n        timeoutCallback: this.onClearTimer,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }), error && React.createElement(\"div\", {\n        className: \"warning_text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, getErrorLocalized(error)), React.createElement(\"div\", {\n        className: \"d-flex\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, React.createElement(Button, {\n        label: STRINGS.USER_VERIFICATION.GO_BACK,\n        className: \"mr-5\",\n        onClick: this.onGoBack,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }), React.createElement(Button, {\n        type: \"button\",\n        onClick: handleSubmit(this.handleSubmit),\n        label: STRINGS.SUBMIT,\n        disabled: pristine || submitting || !valid || !!error || !codeRequested,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return MobileVerification;\n}(Component);\n\nvar MobileVerificationForm = reduxForm({\n  form: FORM_NAME\n})(MobileVerification);\nvar selector = formValueSelector(FORM_NAME);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return selector(state, 'phone_country', 'phone_number');\n};\n\nexport default connect(mapStateToProps)(MobileVerificationForm);","map":{"version":3,"sources":["/home/user/Documents/projects/hollaex/src/containers/Verification/MobileVerification.js"],"names":["React","Component","connect","reduxForm","formValueSelector","SubmissionError","stopSubmit","isMobile","required","renderFields","Button","IconTitle","ElapsedTimer","HeaderSection","STRINGS","PHONE_OPTIONS","ICONS","getErrorLocalized","verifySmsCode","requestSmsCode","FORM_NAME","loadingTimeOut","MobileVerification","state","formFields","codeRequested","codeRequestLoading","isLoadingTimeUp","isTimer","generateFormFields","loading","phone_country","type","label","USER_VERIFICATION","USER_DOCUMENTATION_FORM","FORM_FIELDS","PHONE_CODE_LABEL","placeholder","PHONE_CODE_PLACEHOLDER","options","validate","fullWidth","phone_number","PHONE_NUMBER_LABEL","PHONE_NUMBER_PLACEHOLDER","notification","text","CONNECTING_LOADING","SMS_SEND","status","iconPath","CONNECT_LOADING","BLUE_ARROW_RIGHT","useSvg","className","onClick","handleSendSmsCode","code","SMS_CODE_LABEL","SMS_CODE_PLACEHOLDER","disabled","setState","handleSubmit","_error","values","phone","then","data","props","moveToNextStep","setActivePageContent","catch","err","error","message","response","checkLoadingTime","formatString","SMS_ERROR_SENT_TO","join","dispatch","onGoBack","setActiveTab","setTimeout","onClearTimer","nextProps","activeLanguage","clearTimeout","pristine","submitting","valid","openContactForm","PHONE_VERIFICATION","PHONE_DETAILS","VERIFICATION_PHONE_NEW","INFORMATION","PHONE_VERIFICATION_TXT","PHONE_VERIFICATION_TXT_1","PHONE_VERIFICATION_TXT_2","CODE_EXPIRES_IN","GO_BACK","SUBMIT","MobileVerificationForm","form","selector","mapStateToProps"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,SAAT,EAAoBC,iBAApB,EAAuCC,eAAvC,EAAwDC,UAAxD,QAA0E,YAA1E;AACA,SAASC,QAAT,QAAyB,qBAAzB;AAEA,SAASC,QAAT,QAAyB,mCAAzB;AACA,OAAOC,YAAP,MAAyB,qCAAzB;AACA,SAASC,MAAT,EAAiBC,SAAjB,EAA4BC,YAA5B,EAA0CC,aAA1C,QAA+D,kBAA/D;AACA,OAAOC,OAAP,MAAoB,+BAApB;AACA,SAASC,aAAT,QAA8B,uBAA9B;AACA,SAASC,KAAT,QAAsB,wBAAtB;AACA,SAASC,iBAAT,QAAkC,oBAAlC;AACA,SACCC,aADD,EAECC,cAFD,QAGO,mCAHP;AAKA,IAAMC,SAAS,GAAG,oBAAlB;AACA,IAAIC,cAAc,GAAG,EAArB;;IAEMC,kB;;;;;;;;;;;;;;;;;UACLC,K,GAAQ;AACPC,MAAAA,UAAU,EAAE,EADL;AAEPC,MAAAA,aAAa,EAAE,KAFR;AAGPC,MAAAA,kBAAkB,EAAE,KAHb;AAIPC,MAAAA,eAAe,EAAE,KAJV;AAKPC,MAAAA,OAAO,EAAE;AALF,K;;UAyBRC,kB,GAAqB,YAA4C;AAAA,UAA3CJ,aAA2C,uEAA3B,KAA2B;AAAA,UAApBK,OAAoB,uEAAV,KAAU;AAChE,UAAMN,UAAU,GAAG;AAClBO,QAAAA,aAAa,EAAE;AACdC,UAAAA,IAAI,EAAE,cADQ;AAEdC,UAAAA,KAAK,EACJnB,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CACEC,gBAJW;AAKdC,UAAAA,WAAW,EACVxB,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CACEG,sBAPW;AAQdC,UAAAA,OAAO,EAAEzB,aARK;AASd0B,UAAAA,QAAQ,EAAE,CAACjC,QAAD,CATI;AAUdkC,UAAAA,SAAS,EAAEnC;AAVG,SADG;AAalBoC,QAAAA,YAAY,EAAE;AACbX,UAAAA,IAAI,EAAE,MADO;AAEbC,UAAAA,KAAK,EACJnB,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CACEQ,kBAJU;AAKbN,UAAAA,WAAW,EACVxB,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CACES,wBAPU;AAQbJ,UAAAA,QAAQ,EAAE,CAACjC,QAAD,CARG;AAQS;AACtBsC,UAAAA,YAAY,EAAE;AACbC,YAAAA,IAAI,EAAEjB,OAAO,GACVhB,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CAA8DY,kBADpD,GAEVlC,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CAA8Da,QAHpD;AAIbC,YAAAA,MAAM,EAAEpB,OAAO,GAAG,SAAH,GAAe,aAJjB;AAKbqB,YAAAA,QAAQ,EAAErB,OAAO,GAAGd,KAAK,CAACoC,eAAT,GAA0BpC,KAAK,CAACqC,gBALpC;AAMbC,YAAAA,MAAM,EAAExB,OAAO,GAAG,IAAH,GAAU,KANZ;AAObyB,YAAAA,SAAS,EAAE,kBAPE;AAQbC,YAAAA,OAAO,EAAE1B,OAAO,GAAG,YAAM,CAAE,CAAX,GAAc,MAAK2B;AARtB,WATD;AAmBbf,UAAAA,SAAS,EAAEnC;AAnBE,SAbI;AAkClBmD,QAAAA,IAAI,EAAE;AACL1B,UAAAA,IAAI,EAAE,MADD;AAELC,UAAAA,KAAK,EACJnB,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CACEuB,cAJE;AAKLrB,UAAAA,WAAW,EACVxB,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkDC,WAAlD,CACEwB,oBAPE;AAQLC,UAAAA,QAAQ,EAAE,CAACpC,aARN;AASLgB,UAAAA,QAAQ,EAAE,CAACjC,QAAD,CATL;AAULkC,UAAAA,SAAS,EAAEnC;AAVN;AAlCY,OAAnB;;AAgDA,YAAKuD,QAAL,CAAc;AAAEtC,QAAAA,UAAU,EAAVA;AAAF,OAAd;AACA,K;;UAEDuC,Y,GAAe,gBAA2C;AAAA,UAAxCpB,YAAwC,QAAxCA,YAAwC;AAAA,UAA1BZ,aAA0B,QAA1BA,aAA0B;AAAA,UAAX2B,IAAW,QAAXA,IAAW;;AACzD,UAAI,CAAC,MAAKnC,KAAL,CAAWE,aAAhB,EAA+B;AAC9B,cAAM,IAAIpB,eAAJ,CAAoB;AACzB2D,UAAAA,MAAM,EAAE;AADiB,SAApB,CAAN;AAGA;;AACD,UAAMC,MAAM,GAAG;AACdC,QAAAA,KAAK,YAAKnC,aAAL,SAAqBY,YAArB,CADS;AAEde,QAAAA,IAAI,EAAJA;AAFc,OAAf;AAKA,aAAOxC,aAAa,CAAC+C,MAAD,CAAb,CACLE,IADK,CACA,iBAAc;AAAA,YAAXC,IAAW,SAAXA,IAAW;;AACnB,cAAKC,KAAL,CAAWC,cAAX,CAA0B,QAA1B,EAAoCL,MAApC;;AACA,cAAKI,KAAL,CAAWE,oBAAX,CAAgC,CAAhC;AACA,OAJK,EAKLC,KALK,CAKC,UAACC,GAAD,EAAS;AACf,YAAMC,KAAK,GAAG;AAAEV,UAAAA,MAAM,EAAES,GAAG,CAACE;AAAd,SAAd;;AACA,YAAIF,GAAG,CAACG,QAAJ,IAAgBH,GAAG,CAACG,QAAJ,CAAaR,IAAjC,EAAuC;AACtCM,UAAAA,KAAK,CAACV,MAAN,GAAeS,GAAG,CAACG,QAAJ,CAAaR,IAAb,CAAkBO,OAAjC;AACA;;AACD,cAAM,IAAItE,eAAJ,CAAoBqE,KAApB,CAAN;AACA,OAXK,CAAP;AAYA,K;;UAEDjB,iB,GAAoB,YAAM;AAAA,wBACe,MAAKY,KADpB;AAAA,UACjB1B,YADiB,eACjBA,YADiB;AAAA,UACHZ,aADG,eACHA,aADG;;AAEzB,UAAIA,aAAa,IAAIY,YAArB,EAAmC;AAClC,YAAMuB,KAAK,aAAMnC,aAAN,cAAuBY,YAAvB,CAAX;;AACA,cAAKmB,QAAL,CAAc;AACbpC,UAAAA,kBAAkB,EAAE,IADP;AAEbD,UAAAA,aAAa,EAAE,KAFF;AAGbE,UAAAA,eAAe,EAAE;AAHJ,SAAd,EAIG,YAAM;AACR,gBAAKE,kBAAL,CAAwB,KAAxB,EAA+B,IAA/B;;AACA,gBAAKgD,gBAAL;AACA,SAPD;;AAQA1D,QAAAA,cAAc,CAAC+C,KAAD,CAAd,CACEC,IADF,CACO,iBAAc;AAAA,cAAXC,IAAW,SAAXA,IAAW;;AACnB;AACA,gBAAKN,QAAL,CAAc;AACbrC,YAAAA,aAAa,EAAE,IADF;AAEbC,YAAAA,kBAAkB,EAAE,KAFP;AAGbE,YAAAA,OAAO,EAAE,MAAKL,KAAL,CAAWI;AAHP,WAAd,EAIG,YAAM;AACR,gBAAIG,OAAO,GAAG,MAAKP,KAAL,CAAWI,eAAX,GAA6B,KAA7B,GAAqC,IAAnD;;AACA,kBAAKE,kBAAL,CAAwB,IAAxB,EAA8BC,OAA9B;AACA,WAPD;AAQA,SAXF,EAYE0C,KAZF,CAYQ,UAACC,GAAD,EAAS;AACf,cAAMC,KAAK,GAAG;AAAEV,YAAAA,MAAM,EAAElD,OAAO,CAACgE,YAAR,CAAqBhE,OAAO,CAACiE,iBAA7B,EAAgDb,KAAhD,EAAuDc,IAAvD,CAA4D,EAA5D;AAAV,WAAd;;AACA,gBAAKlB,QAAL,CAAc;AAAEpC,YAAAA,kBAAkB,EAAE;AAAtB,WAAd,EAA6C,YAAM;AAClD,kBAAKG,kBAAL;AACA,WAFD;;AAGA,gBAAKwC,KAAL,CAAWY,QAAX,CAAoB3E,UAAU,CAACc,SAAD,EAAYsD,KAAZ,CAA9B;AACA,SAlBF;AAmBA;AACD,K;;UAEDQ,Q,GAAW,YAAM;AAChB,YAAKb,KAAL,CAAWE,oBAAX,CAAgC,CAAhC;;AACA,YAAKF,KAAL,CAAWc,YAAX,CAAwB,CAAxB;AACA,K;;UAEDN,gB,GAAmB,YAAM;AACxBxD,MAAAA,cAAc,GAAG+D,UAAU,CAAC,YAAM;AACjC,YAAIxD,OAAO,GAAG,KAAd;;AACA,YAAI,MAAKL,KAAL,CAAWE,aAAf,EAA8B;AAC7B,gBAAKI,kBAAL,CAAwB,IAAxB,EAA8B,KAA9B;;AACAD,UAAAA,OAAO,GAAG,IAAV;AACA;;AACD,cAAKkC,QAAL,CAAc;AAAEnC,UAAAA,eAAe,EAAE,IAAnB;AAAyBC,UAAAA,OAAO,EAAPA;AAAzB,SAAd;AACA,OAP0B,EAOxB,IAPwB,CAA3B;AAQA,K;;UAEDyD,Y,GAAe,YAAM;AACpB,YAAKvB,QAAL,CAAc;AAAElC,QAAAA,OAAO,EAAE,KAAX;AAAkBH,QAAAA,aAAa,EAAE;AAAjC,OAAd,EAAwD,YAAM;AAC7D,cAAKI,kBAAL;AACA,OAFD;AAGA,K;;;;;;;wCApJmB;AACnB,WAAKA,kBAAL;AACA;;;8CAEyByD,S,EAAW;AACpC,UAAIA,SAAS,CAACC,cAAV,KAA6B,KAAKlB,KAAL,CAAWkB,cAA5C,EAA4D;AAC3D,aAAK1D,kBAAL;AACA;AACD;;;2CAEsB;AACtB,UAAIR,cAAJ,EAAoB;AACnBmE,QAAAA,YAAY,CAACnE,cAAD,CAAZ;AACA;AACD;;;6BAwIQ;AAAA,yBAQJ,KAAKgD,KARD;AAAA,UAEPN,YAFO,gBAEPA,YAFO;AAAA,UAGP0B,QAHO,gBAGPA,QAHO;AAAA,UAIPC,UAJO,gBAIPA,UAJO;AAAA,UAKPC,KALO,gBAKPA,KALO;AAAA,UAMPjB,KANO,gBAMPA,KANO;AAAA,UAOPkB,eAPO,gBAOPA,eAPO;AAAA,wBASuC,KAAKrE,KAT5C;AAAA,UASAC,UATA,eASAA,UATA;AAAA,UASYC,aATZ,eASYA,aATZ;AAAA,UAS2BG,OAT3B,eAS2BA,OAT3B;AAUR,aACC;AAAK,QAAA,SAAS,EAAC,yDAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACC,oBAAC,SAAD;AAAW,QAAA,IAAI,EAAEd,OAAO,CAACoB,iBAAR,CAA0B2D,kBAA3C;AAA+D,QAAA,QAAQ,EAAC,OAAxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADD,EAEC;AAAM,QAAA,SAAS,EAAC,4DAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACC,oBAAC,aAAD;AACC,QAAA,KAAK,EAAE/E,OAAO,CAACoB,iBAAR,CAA0B4D,aADlC;AAEC,QAAA,eAAe,EAAEF,eAFlB;AAGC,QAAA,IAAI,EAAE5E,KAAK,CAAC+E,sBAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAKC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAMjF,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkD6D,WAAlD,CAA8DC,sBAApE,CALD,EAMC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAMnF,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkD6D,WAAlD,CAA8DE,wBAApE,CAND,EAOC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAMpF,OAAO,CAACoB,iBAAR,CAA0BC,uBAA1B,CAAkD6D,WAAlD,CAA8DG,wBAApE,CAPD,CADD,EAUE1F,YAAY,CAACe,UAAD,CAVd,EAWC,oBAAC,YAAD;AACC,QAAA,SAAS,EAAEV,OAAO,CAACoB,iBAAR,CAA0BkE,eADtC;AAEC,QAAA,SAAS,EAAExE,OAFZ;AAGC,QAAA,eAAe,EAAE,KAAKyD,YAHvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAXD,EAeEX,KAAK,IACL;AAAK,QAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA+BzD,iBAAiB,CAACyD,KAAD,CAAhD,CAhBF,EAkBC;AAAK,QAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACC,oBAAC,MAAD;AACC,QAAA,KAAK,EAAE5D,OAAO,CAACoB,iBAAR,CAA0BmE,OADlC;AAEC,QAAA,SAAS,EAAC,MAFX;AAGC,QAAA,OAAO,EAAE,KAAKnB,QAHf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADD,EAMC,oBAAC,MAAD;AACC,QAAA,IAAI,EAAC,QADN;AAEC,QAAA,OAAO,EAAEnB,YAAY,CAAC,KAAKA,YAAN,CAFtB;AAGC,QAAA,KAAK,EAAEjD,OAAO,CAACwF,MAHhB;AAIC,QAAA,QAAQ,EACPb,QAAQ,IAAIC,UAAZ,IAA0B,CAACC,KAA3B,IAAoC,CAAC,CAACjB,KAAtC,IAA+C,CAACjD,aALlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAND,CAlBD,CAFD,CADD;AAuCA;;;;EAhN+BxB,S;;AAmNjC,IAAMsG,sBAAsB,GAAGpG,SAAS,CAAC;AACxCqG,EAAAA,IAAI,EAAEpF;AADkC,CAAD,CAAT,CAE5BE,kBAF4B,CAA/B;AAIA,IAAMmF,QAAQ,GAAGrG,iBAAiB,CAACgB,SAAD,CAAlC;;AAEA,IAAMsF,eAAe,GAAG,SAAlBA,eAAkB,CAACnF,KAAD;AAAA,SACvBkF,QAAQ,CAAClF,KAAD,EAAQ,eAAR,EAAyB,cAAzB,CADe;AAAA,CAAxB;;AAGA,eAAerB,OAAO,CAACwG,eAAD,CAAP,CAAyBH,sBAAzB,CAAf","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { reduxForm, formValueSelector, SubmissionError, stopSubmit } from 'redux-form';\nimport { isMobile } from 'react-device-detect';\n\nimport { required } from '../../components/Form/validations';\nimport renderFields from '../../components/Form/factoryFields';\nimport { Button, IconTitle, ElapsedTimer, HeaderSection } from '../../components';\nimport STRINGS from '../../config/localizedStrings';\nimport { PHONE_OPTIONS } from '../../utils/countries';\nimport { ICONS } from '../../config/constants';\nimport { getErrorLocalized } from '../../utils/errors';\nimport {\n\tverifySmsCode,\n\trequestSmsCode\n} from '../../actions/verificationActions';\n\nconst FORM_NAME = 'MobileVerification';\nlet loadingTimeOut = '';\n\nclass MobileVerification extends Component {\n\tstate = {\n\t\tformFields: {},\n\t\tcodeRequested: false,\n\t\tcodeRequestLoading: false,\n\t\tisLoadingTimeUp: false,\n\t\tisTimer: false\n\t};\n\n\tcomponentDidMount() {\n\t\tthis.generateFormFields();\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif (nextProps.activeLanguage !== this.props.activeLanguage) {\n\t\t\tthis.generateFormFields();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif (loadingTimeOut) {\n\t\t\tclearTimeout(loadingTimeOut);\n\t\t}\n\t}\n\t\n\n\tgenerateFormFields = (codeRequested = false, loading = false) => {\n\t\tconst formFields = {\n\t\t\tphone_country: {\n\t\t\t\ttype: 'autocomplete',\n\t\t\t\tlabel:\n\t\t\t\t\tSTRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS\n\t\t\t\t\t\t.PHONE_CODE_LABEL,\n\t\t\t\tplaceholder:\n\t\t\t\t\tSTRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS\n\t\t\t\t\t\t.PHONE_CODE_PLACEHOLDER,\n\t\t\t\toptions: PHONE_OPTIONS,\n\t\t\t\tvalidate: [required],\n\t\t\t\tfullWidth: isMobile\n\t\t\t},\n\t\t\tphone_number: {\n\t\t\t\ttype: 'text',\n\t\t\t\tlabel:\n\t\t\t\t\tSTRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS\n\t\t\t\t\t\t.PHONE_NUMBER_LABEL,\n\t\t\t\tplaceholder:\n\t\t\t\t\tSTRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS\n\t\t\t\t\t\t.PHONE_NUMBER_PLACEHOLDER,\n\t\t\t\tvalidate: [required], // TODO ^\\+?[1-9]\\d{1,14}$\n\t\t\t\tnotification: {\n\t\t\t\t\ttext: loading\n\t\t\t\t\t\t? STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.CONNECTING_LOADING\n\t\t\t\t\t\t: STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS.SMS_SEND,\n\t\t\t\t\tstatus: loading ? 'loading' : 'information',\n\t\t\t\t\ticonPath: loading ? ICONS.CONNECT_LOADING :ICONS.BLUE_ARROW_RIGHT,\n\t\t\t\t\tuseSvg: loading ? true : false,\n\t\t\t\t\tclassName: 'file_upload_icon',\n\t\t\t\t\tonClick: loading ? () => {} : this.handleSendSmsCode\n\t\t\t\t},\n\t\t\t\tfullWidth: isMobile\n\t\t\t},\n\t\t\tcode: {\n\t\t\t\ttype: 'text',\n\t\t\t\tlabel:\n\t\t\t\t\tSTRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS\n\t\t\t\t\t\t.SMS_CODE_LABEL,\n\t\t\t\tplaceholder:\n\t\t\t\t\tSTRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.FORM_FIELDS\n\t\t\t\t\t\t.SMS_CODE_PLACEHOLDER,\n\t\t\t\tdisabled: !codeRequested,\n\t\t\t\tvalidate: [required],\n\t\t\t\tfullWidth: isMobile\n\t\t\t}\n\t\t};\n\n\t\tthis.setState({ formFields });\n\t};\n\n\thandleSubmit = ({ phone_number, phone_country, code }) => {\n\t\tif (!this.state.codeRequested) {\n\t\t\tthrow new SubmissionError({\n\t\t\t\t_error: 'Request sms code'\n\t\t\t});\n\t\t}\n\t\tconst values = {\n\t\t\tphone: `${phone_country}${phone_number}`,\n\t\t\tcode\n\t\t};\n\n\t\treturn verifySmsCode(values)\n\t\t\t.then(({ data }) => {\n\t\t\t\tthis.props.moveToNextStep('mobile', values);\n\t\t\t\tthis.props.setActivePageContent(0);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconst error = { _error: err.message };\n\t\t\t\tif (err.response && err.response.data) {\n\t\t\t\t\terror._error = err.response.data.message;\n\t\t\t\t}\n\t\t\t\tthrow new SubmissionError(error);\n\t\t\t});\n\t};\n\n\thandleSendSmsCode = () => {\n\t\tconst { phone_number, phone_country } = this.props;\n\t\tif (phone_country && phone_number) {\n\t\t\tconst phone = `${phone_country} ${phone_number}`;\n\t\t\tthis.setState({\n\t\t\t\tcodeRequestLoading: true,\n\t\t\t\tcodeRequested: false,\n\t\t\t\tisLoadingTimeUp: false\n\t\t\t}, () => {\n\t\t\t\tthis.generateFormFields(false, true);\n\t\t\t\tthis.checkLoadingTime();\n\t\t\t});\n\t\t\trequestSmsCode(phone)\n\t\t\t\t.then(({ data }) => {\n\t\t\t\t\t// alert(STRINGS.formatString(STRINGS.SMS_SENT_TO, phone).join(''));\n\t\t\t\t\tthis.setState({ \n\t\t\t\t\t\tcodeRequested: true,\n\t\t\t\t\t\tcodeRequestLoading: false,\n\t\t\t\t\t\tisTimer: this.state.isLoadingTimeUp\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\tlet loading = this.state.isLoadingTimeUp ? false : true;\n\t\t\t\t\t\tthis.generateFormFields(true, loading);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconst error = { _error: STRINGS.formatString(STRINGS.SMS_ERROR_SENT_TO, phone).join('') };\n\t\t\t\t\tthis.setState({ codeRequestLoading: false }, () => {\n\t\t\t\t\t\tthis.generateFormFields();\n\t\t\t\t\t});\n\t\t\t\t\tthis.props.dispatch(stopSubmit(FORM_NAME, error));\n\t\t\t\t});\n\t\t}\n\t};\n\n\tonGoBack = () => {\n\t\tthis.props.setActivePageContent(0);\n\t\tthis.props.setActiveTab(3);\n\t};\n\n\tcheckLoadingTime = () => {\n\t\tloadingTimeOut = setTimeout(() => {\n\t\t\tlet isTimer = false;\n\t\t\tif (this.state.codeRequested) {\n\t\t\t\tthis.generateFormFields(true, false);\n\t\t\t\tisTimer = true;\n\t\t\t}\n\t\t\tthis.setState({ isLoadingTimeUp: true, isTimer });\n\t\t}, 3000);\n\t};\n\n\tonClearTimer = () => {\n\t\tthis.setState({ isTimer: false, codeRequested: false }, () => {\n\t\t\tthis.generateFormFields();\n\t\t});\n\t};\n\n\trender() {\n\t\tconst {\n\t\t\thandleSubmit,\n\t\t\tpristine,\n\t\t\tsubmitting,\n\t\t\tvalid,\n\t\t\terror,\n\t\t\topenContactForm\n\t\t} = this.props;\n\t\tconst { formFields, codeRequested, isTimer } = this.state;\n\t\treturn (\n\t\t\t<div className=\"presentation_container apply_rtl verification_container\">\n\t\t\t\t<IconTitle text={STRINGS.USER_VERIFICATION.PHONE_VERIFICATION} textType=\"title\" />\n\t\t\t\t<form className=\"d-flex flex-column w-100 verification_content-form-wrapper\">\n\t\t\t\t\t<HeaderSection\n\t\t\t\t\t\ttitle={STRINGS.USER_VERIFICATION.PHONE_DETAILS}\n\t\t\t\t\t\topenContactForm={openContactForm}\n\t\t\t\t\t\ticon={ICONS.VERIFICATION_PHONE_NEW}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div>{STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.INFORMATION.PHONE_VERIFICATION_TXT}</div>\n\t\t\t\t\t\t<div>{STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.INFORMATION.PHONE_VERIFICATION_TXT_1}</div>\n\t\t\t\t\t\t<div>{STRINGS.USER_VERIFICATION.USER_DOCUMENTATION_FORM.INFORMATION.PHONE_VERIFICATION_TXT_2}</div>\n\t\t\t\t\t</HeaderSection>\n\t\t\t\t\t{renderFields(formFields)}\n\t\t\t\t\t<ElapsedTimer\n\t\t\t\t\t\ttimerText={STRINGS.USER_VERIFICATION.CODE_EXPIRES_IN}\n\t\t\t\t\t\tisLoading={isTimer}\n\t\t\t\t\t\ttimeoutCallback={this.onClearTimer} />\n\t\t\t\t\t{error && (\n\t\t\t\t\t\t<div className=\"warning_text\">{getErrorLocalized(error)}</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"d-flex\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tlabel={STRINGS.USER_VERIFICATION.GO_BACK}\n\t\t\t\t\t\t\tclassName=\"mr-5\"\n\t\t\t\t\t\t\tonClick={this.onGoBack}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tonClick={handleSubmit(this.handleSubmit)}\n\t\t\t\t\t\t\tlabel={STRINGS.SUBMIT}\n\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\tpristine || submitting || !valid || !!error || !codeRequested\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nconst MobileVerificationForm = reduxForm({\n\tform: FORM_NAME\n})(MobileVerification);\n\nconst selector = formValueSelector(FORM_NAME);\n\nconst mapStateToProps = (state) =>\n\tselector(state, 'phone_country', 'phone_number');\n\nexport default connect(mapStateToProps)(MobileVerificationForm);\n"]},"metadata":{},"sourceType":"module"}