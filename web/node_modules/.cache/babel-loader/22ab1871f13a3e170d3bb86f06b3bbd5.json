{"ast":null,"code":"import _classCallCheck from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/user/Documents/projects/hollaex/src/containers/UserSecurity/index.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { SubmissionError } from 'redux-form';\nimport { isMobile } from 'react-device-detect';\nimport { ICONS } from '../../config/constants';\nimport { resetPassword, otpRequest, otpActivate, otpSetActivated as _otpSetActivated, otpRevoke } from '../../actions/userAction';\nimport { Accordion, Dialog, SuccessDisplay, OtpForm, IconTitle, Loader } from '../../components';\nimport { errorHandler } from '../../components/OtpForm/utils';\nimport ChangePasswordForm, { generateFormValues } from './ChangePasswordForm';\nimport { OTP, renderOTPForm } from './OTP';\nimport { DeveloperSection } from './DeveloperSection';\nimport STRINGS from '../../config/localizedStrings';\n\nvar UserVerification =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(UserVerification, _Component);\n\n  function UserVerification() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, UserVerification);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(UserVerification)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      sections: [],\n      dialogIsOpen: false,\n      modalText: ''\n    };\n\n    _this.calculateSections = function (user) {\n      var formValues = generateFormValues();\n      var otp_enabled = user.otp_enabled,\n          otp = user.otp,\n          verification_level = user.verification_level;\n      var sections = [{\n        title: STRINGS.ACCOUNT_SECURITY.OTP.TITLE,\n        content: React.createElement(OTP, {\n          requestOTP: _this.handleOTPCheckbox,\n          data: otp,\n          otp_enabled: otp_enabled,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 75\n          },\n          __self: this\n        }),\n        notification: {\n          text: otp_enabled ? STRINGS.ACCOUNT_SECURITY.OTP.OTP_ENABLED : STRINGS.ACCOUNT_SECURITY.OTP.OTP_DISABLED,\n          status: otp_enabled ? 'success' : 'warning',\n          iconPath: otp_enabled ? ICONS.GREEN_CHECK : ICONS.RED_ARROW,\n          allowClick: !otp_enabled\n        }\n      }, {\n        title: STRINGS.ACCOUNT_SECURITY.CHANGE_PASSWORD.TITLE,\n        content: React.createElement(ChangePasswordForm, {\n          onSubmit: _this.onSubmitChangePassword,\n          formFields: formValues,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 106\n          },\n          __self: this\n        }),\n        disabled: false,\n        notification: {\n          text: STRINGS.ACCOUNT_SECURITY.CHANGE_PASSWORD.ACTIVE,\n          status: 'success',\n          iconPath: ICONS.GREEN_CHECK,\n          allowClick: true\n        }\n      }, {\n        title: STRINGS.DEVELOPER_SECTION.TITLE,\n        content: React.createElement(DeveloperSection, {\n          otp_enabled: otp_enabled,\n          openOtp: _this.openOtp,\n          verification_level: verification_level,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 122\n          },\n          __self: this\n        }),\n        disabled: false,\n        notification: {\n          // text: STRINGS.DEVELOPER_SECTION[otp_enabled ? 'ACTIVE' : 'INACTIVE'],\n          status: otp_enabled ? 'success' : 'disabled',\n          iconPath: otp_enabled ? ICONS.TOKENS_ACTIVE : ICONS.TOKENS_INACTIVE,\n          // TODO check\n          allowClick: true\n        }\n      }];\n\n      _this.setState({\n        sections: sections\n      });\n    };\n\n    _this.handleOTPCheckbox = function () {\n      var checked = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (checked) {\n        _this.props.requestOTP();\n      } else {\n        // TODO cancel otp\n        _this.setState({\n          dialogIsOpen: true,\n          modalText: ''\n        });\n      }\n    };\n\n    _this.onSubmitActivateOtp = function (values) {\n      return otpActivate(values).then(function (res) {\n        _this.props.otpSetActivated(true);\n\n        _this.accordion.closeAll();\n\n        _this.setState({\n          dialogIsOpen: true,\n          modalText: STRINGS.ACCOUNT_SECURITY.OTP.DIALOG.SUCCESS\n        });\n      }).catch(function (err) {\n        var _error = err.response.data ? err.response.data.message : err.message;\n\n        throw new SubmissionError({\n          code: _error\n        });\n      });\n    };\n\n    _this.onSubmitChangePassword = function (values) {\n      return resetPassword({\n        old_password: values.old_password,\n        new_password: values.new_password\n      }).then(function (res) {\n        _this.accordion.closeAll();\n\n        _this.setState({\n          dialogIsOpen: true,\n          modalText: STRINGS.ACCOUNT_SECURITY.CHANGE_PASSWORD.DIALOG.SUCCESS\n        });\n      }).catch(function (err) {\n        var _error = err.response.data ? err.response.data.message : err.message;\n\n        throw new SubmissionError({\n          _error: _error\n        });\n      });\n    };\n\n    _this.onSubmitCancelOTP = function (values) {\n      return otpRevoke({\n        code: values.otp_code\n      }).then(function () {\n        _this.props.otpSetActivated(false);\n\n        _this.setState({\n          dialogIsOpen: true,\n          modalText: STRINGS.ACCOUNT_SECURITY.OTP.DIALOG.REVOKE\n        });\n      }).catch(errorHandler);\n    };\n\n    _this.setRef = function (el) {\n      _this.accordion = el;\n    };\n\n    _this.openOtp = function () {\n      _this.accordion.openSection(2, false);\n\n      setTimeout(function () {\n        _this.accordion.openSection(0);\n      }, 250);\n    };\n\n    _this.openDevelopers = function () {\n      setTimeout(function () {\n        _this.accordion.openSection(2);\n      }, 250);\n    };\n\n    _this.renderModalContent = function () {\n      return React.createElement(SuccessDisplay, {\n        onClick: _this.onCloseDialog,\n        text: _this.state.modalText,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      });\n    };\n\n    _this.onCloseDialog = function () {\n      _this.setState({\n        dialogIsOpen: false\n      });\n    };\n\n    _this.renderModalContent = function (_ref, otp_enabled, email, modalText) {\n      var requested = _ref.requested,\n          activated = _ref.activated,\n          secret = _ref.secret,\n          error = _ref.error;\n\n      if (error) {\n        return React.createElement(SuccessDisplay, {\n          onClick: _this.onCloseDialog,\n          text: error,\n          success: false,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 241\n          },\n          __self: this\n        });\n      } else if (otp_enabled && !modalText) {\n        return React.createElement(OtpForm, {\n          onSubmit: _this.onSubmitCancelOTP,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 248\n          },\n          __self: this\n        });\n      } else if (requested && !activated) {\n        return renderOTPForm(secret, email, _this.onSubmitActivateOtp);\n      } else {\n        return React.createElement(SuccessDisplay, {\n          onClick: _this.onCloseDialog,\n          text: modalText,\n          success: !error,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 253\n          },\n          __self: this\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(UserVerification, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.calculateSections(this.props.user);\n\n      if (this.props.openApiKey) {\n        this.openDevelopers();\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.user.otp.requested !== this.props.user.otp.requested || nextProps.user.otp.requesting !== this.props.user.otp.requesting || nextProps.user.otp.activated !== this.props.user.otp.activated || nextProps.user.otp_enabled !== this.props.user.otp_enabled || nextProps.activeLanguage !== this.props.activeLanguage) {\n        this.calculateSections(nextProps.user);\n      }\n\n      if (nextProps.user.otp.requested && nextProps.user.otp.requested !== this.props.user.otp.requested) {\n        this.setState({\n          dialogIsOpen: true,\n          modalText: ''\n        });\n      } else if (nextProps.user.otp.error !== this.props.user.otp.error) {\n        this.setState({\n          dialogIsOpen: true,\n          modalText: nextProps.user.otp.error\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.props.user.verification_level === 0) {\n        return React.createElement(Loader, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 264\n          },\n          __self: this\n        });\n      }\n\n      var _this$state = this.state,\n          sections = _this$state.sections,\n          dialogIsOpen = _this$state.dialogIsOpen,\n          modalText = _this$state.modalText;\n      var _this$props$user = this.props.user,\n          otp = _this$props$user.otp,\n          email = _this$props$user.email,\n          otp_enabled = _this$props$user.otp_enabled;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }, !isMobile && React.createElement(IconTitle, {\n        text: STRINGS.ACCOUNTS.TAB_SECURITY,\n        textType: \"title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }), React.createElement(Accordion, {\n        sections: sections,\n        ref: this.setRef,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276\n        },\n        __self: this\n      }), React.createElement(Dialog, {\n        isOpen: dialogIsOpen && !otp.requesting,\n        label: \"security-modal\",\n        onCloseDialog: this.onCloseDialog,\n        showCloseText: !(otp.error || modalText),\n        theme: this.props.activeTheme,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277\n        },\n        __self: this\n      }, dialogIsOpen && !otp.requesting ? this.renderModalContent(otp, otp_enabled, email, modalText) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return UserVerification;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.user,\n    activeLanguage: state.app.language,\n    activeTheme: state.app.theme\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    requestOTP: function requestOTP() {\n      return dispatch(otpRequest());\n    },\n    otpSetActivated: function otpSetActivated(active) {\n      return dispatch(_otpSetActivated(active));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserVerification);","map":{"version":3,"sources":["/home/user/Documents/projects/hollaex/src/containers/UserSecurity/index.js"],"names":["React","Component","connect","SubmissionError","isMobile","ICONS","resetPassword","otpRequest","otpActivate","otpSetActivated","otpRevoke","Accordion","Dialog","SuccessDisplay","OtpForm","IconTitle","Loader","errorHandler","ChangePasswordForm","generateFormValues","OTP","renderOTPForm","DeveloperSection","STRINGS","UserVerification","state","sections","dialogIsOpen","modalText","calculateSections","user","formValues","otp_enabled","otp","verification_level","title","ACCOUNT_SECURITY","TITLE","content","handleOTPCheckbox","notification","text","OTP_ENABLED","OTP_DISABLED","status","iconPath","GREEN_CHECK","RED_ARROW","allowClick","CHANGE_PASSWORD","onSubmitChangePassword","disabled","ACTIVE","DEVELOPER_SECTION","openOtp","TOKENS_ACTIVE","TOKENS_INACTIVE","setState","checked","props","requestOTP","onSubmitActivateOtp","values","then","res","accordion","closeAll","DIALOG","SUCCESS","catch","err","_error","response","data","message","code","old_password","new_password","onSubmitCancelOTP","otp_code","REVOKE","setRef","el","openSection","setTimeout","openDevelopers","renderModalContent","onCloseDialog","email","requested","activated","secret","error","openApiKey","nextProps","requesting","activeLanguage","ACCOUNTS","TAB_SECURITY","activeTheme","mapStateToProps","app","language","theme","mapDispatchToProps","dispatch","active"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { SubmissionError } from 'redux-form';\nimport { isMobile } from 'react-device-detect';\n\nimport { ICONS } from '../../config/constants';\nimport {\n\tresetPassword,\n\totpRequest,\n\totpActivate,\n\totpSetActivated,\n\totpRevoke\n} from '../../actions/userAction';\nimport {\n\tAccordion,\n\tDialog,\n\tSuccessDisplay,\n\tOtpForm,\n\tIconTitle,\n\tLoader\n} from '../../components';\nimport { errorHandler } from '../../components/OtpForm/utils';\nimport ChangePasswordForm, { generateFormValues } from './ChangePasswordForm';\nimport { OTP, renderOTPForm } from './OTP';\nimport { DeveloperSection } from './DeveloperSection';\n\nimport STRINGS from '../../config/localizedStrings';\n\nclass UserVerification extends Component {\n\tstate = {\n\t\tsections: [],\n\t\tdialogIsOpen: false,\n\t\tmodalText: ''\n\t};\n\n\tcomponentDidMount() {\n\t\tthis.calculateSections(this.props.user);\n\t\tif (this.props.openApiKey) {\n\t\t\tthis.openDevelopers();\n\t\t}\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif (\n\t\t\tnextProps.user.otp.requested !== this.props.user.otp.requested ||\n\t\t\tnextProps.user.otp.requesting !== this.props.user.otp.requesting ||\n\t\t\tnextProps.user.otp.activated !== this.props.user.otp.activated ||\n\t\t\tnextProps.user.otp_enabled !== this.props.user.otp_enabled ||\n\t\t\tnextProps.activeLanguage !== this.props.activeLanguage\n\t\t) {\n\t\t\tthis.calculateSections(nextProps.user);\n\t\t}\n\n\t\tif (\n\t\t\tnextProps.user.otp.requested &&\n\t\t\tnextProps.user.otp.requested !== this.props.user.otp.requested\n\t\t) {\n\t\t\tthis.setState({ dialogIsOpen: true, modalText: '' });\n\t\t} else if (nextProps.user.otp.error !== this.props.user.otp.error) {\n\t\t\tthis.setState({\n\t\t\t\tdialogIsOpen: true,\n\t\t\t\tmodalText: nextProps.user.otp.error\n\t\t\t});\n\t\t}\n\t}\n\n\tcalculateSections = (user) => {\n\t\tconst formValues = generateFormValues();\n\t\tconst { otp_enabled, otp, verification_level } = user;\n\n\t\tconst sections = [\n\t\t\t{\n\t\t\t\ttitle: STRINGS.ACCOUNT_SECURITY.OTP.TITLE,\n\t\t\t\tcontent: (\n\t\t\t\t\t<OTP\n\t\t\t\t\t\trequestOTP={this.handleOTPCheckbox}\n\t\t\t\t\t\tdata={otp}\n\t\t\t\t\t\totp_enabled={otp_enabled}\n\t\t\t\t\t>\n\t\t\t\t\t\t{/*otp_enabled && (\n\t\t\t\t\t\t\t<div className=\"d-flex flex-column\">\n\t\t\t\t\t\t\t\t<CheckboxButton\n\t\t\t\t\t\t\t\t\tlabel={STRINGS.ACCOUNT_SECURITY.OTP.ENABLED_TEXTS.TEXT_1}\n\t\t\t\t\t\t\t\t\tchecked={true}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<CheckboxButton\n\t\t\t\t\t\t\t\t\tlabel={STRINGS.ACCOUNT_SECURITY.OTP.ENABLED_TEXTS.TEXT_2}\n\t\t\t\t\t\t\t\t\tchecked={true}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)*/}\n\t\t\t\t\t</OTP>\n\t\t\t\t),\n\t\t\t\tnotification: {\n\t\t\t\t\ttext: otp_enabled\n\t\t\t\t\t\t? STRINGS.ACCOUNT_SECURITY.OTP.OTP_ENABLED\n\t\t\t\t\t\t: STRINGS.ACCOUNT_SECURITY.OTP.OTP_DISABLED,\n\t\t\t\t\tstatus: otp_enabled ? 'success' : 'warning',\n\t\t\t\t\ticonPath: otp_enabled ? ICONS.GREEN_CHECK : ICONS.RED_ARROW,\n\t\t\t\t\tallowClick: !otp_enabled\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: STRINGS.ACCOUNT_SECURITY.CHANGE_PASSWORD.TITLE,\n\t\t\t\tcontent: (\n\t\t\t\t\t<ChangePasswordForm\n\t\t\t\t\t\tonSubmit={this.onSubmitChangePassword}\n\t\t\t\t\t\tformFields={formValues}\n\t\t\t\t\t/>\n\t\t\t\t),\n\t\t\t\tdisabled: false,\n\t\t\t\tnotification: {\n\t\t\t\t\ttext: STRINGS.ACCOUNT_SECURITY.CHANGE_PASSWORD.ACTIVE,\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t\ticonPath: ICONS.GREEN_CHECK,\n\t\t\t\t\tallowClick: true\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: STRINGS.DEVELOPER_SECTION.TITLE,\n\t\t\t\tcontent: (\n\t\t\t\t\t<DeveloperSection\n\t\t\t\t\t\totp_enabled={otp_enabled}\n\t\t\t\t\t\topenOtp={this.openOtp}\n\t\t\t\t\t\tverification_level={verification_level}\n\t\t\t\t\t/>\n\t\t\t\t),\n\t\t\t\tdisabled: false,\n\t\t\t\tnotification: {\n\t\t\t\t\t// text: STRINGS.DEVELOPER_SECTION[otp_enabled ? 'ACTIVE' : 'INACTIVE'],\n\t\t\t\t\tstatus: otp_enabled ? 'success' : 'disabled',\n\t\t\t\t\ticonPath: otp_enabled\n\t\t\t\t\t\t? ICONS.TOKENS_ACTIVE\n\t\t\t\t\t\t: ICONS.TOKENS_INACTIVE, // TODO check\n\t\t\t\t\tallowClick: true\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tthis.setState({ sections });\n\t};\n\n\thandleOTPCheckbox = (checked = false) => {\n\t\tif (checked) {\n\t\t\tthis.props.requestOTP();\n\t\t} else {\n\t\t\t// TODO cancel otp\n\t\t\tthis.setState({ dialogIsOpen: true, modalText: '' });\n\t\t}\n\t};\n\n\tonSubmitActivateOtp = (values) => {\n\t\treturn otpActivate(values)\n\t\t\t.then((res) => {\n\t\t\t\tthis.props.otpSetActivated(true);\n\t\t\t\tthis.accordion.closeAll();\n\t\t\t\tthis.setState({\n\t\t\t\t\tdialogIsOpen: true,\n\t\t\t\t\tmodalText: STRINGS.ACCOUNT_SECURITY.OTP.DIALOG.SUCCESS\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconst _error = err.response.data\n\t\t\t\t\t? err.response.data.message\n\t\t\t\t\t: err.message;\n\t\t\t\tthrow new SubmissionError({ code: _error });\n\t\t\t});\n\t};\n\n\tonSubmitChangePassword = (values) => {\n\t\treturn resetPassword({\n\t\t\told_password: values.old_password,\n\t\t\tnew_password: values.new_password\n\t\t})\n\t\t\t.then((res) => {\n\t\t\t\tthis.accordion.closeAll();\n\t\t\t\tthis.setState({\n\t\t\t\t\tdialogIsOpen: true,\n\t\t\t\t\tmodalText:\n\t\t\t\t\t\tSTRINGS.ACCOUNT_SECURITY.CHANGE_PASSWORD.DIALOG.SUCCESS\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconst _error = err.response.data\n\t\t\t\t\t? err.response.data.message\n\t\t\t\t\t: err.message;\n\t\t\t\tthrow new SubmissionError({ _error });\n\t\t\t});\n\t};\n\n\tonSubmitCancelOTP = (values) => {\n\t\treturn otpRevoke({ code: values.otp_code })\n\t\t\t.then(() => {\n\t\t\t\tthis.props.otpSetActivated(false);\n\t\t\t\tthis.setState({\n\t\t\t\t\tdialogIsOpen: true,\n\t\t\t\t\tmodalText: STRINGS.ACCOUNT_SECURITY.OTP.DIALOG.REVOKE\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(errorHandler);\n\t};\n\n\tsetRef = (el) => {\n\t\tthis.accordion = el;\n\t};\n\n\topenOtp = () => {\n\t\tthis.accordion.openSection(2, false);\n\t\tsetTimeout(() => {\n\t\t\tthis.accordion.openSection(0);\n\t\t}, 250);\n\t};\n\n\topenDevelopers = () => {\n\t\tsetTimeout(() => {\n\t\t\tthis.accordion.openSection(2);\n\t\t}, 250);\n\t};\n\n\trenderModalContent = () => {\n\t\treturn (\n\t\t\t<SuccessDisplay\n\t\t\t\tonClick={this.onCloseDialog}\n\t\t\t\ttext={this.state.modalText}\n\t\t\t/>\n\t\t);\n\t};\n\n\tonCloseDialog = () => {\n\t\tthis.setState({ dialogIsOpen: false });\n\t};\n\n\trenderModalContent = (\n\t\t{ requested, activated, secret, error },\n\t\totp_enabled,\n\t\temail,\n\t\tmodalText\n\t) => {\n\t\tif (error) {\n\t\t\treturn (\n\t\t\t\t<SuccessDisplay\n\t\t\t\t\tonClick={this.onCloseDialog}\n\t\t\t\t\ttext={error}\n\t\t\t\t\tsuccess={false}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else if (otp_enabled && !modalText) {\n\t\t\treturn <OtpForm onSubmit={this.onSubmitCancelOTP} />;\n\t\t} else if (requested && !activated) {\n\t\t\treturn renderOTPForm(secret, email, this.onSubmitActivateOtp);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<SuccessDisplay\n\t\t\t\t\tonClick={this.onCloseDialog}\n\t\t\t\t\ttext={modalText}\n\t\t\t\t\tsuccess={!error}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t};\n\n\trender() {\n\t\tif (this.props.user.verification_level === 0) {\n\t\t\treturn <Loader />;\n\t\t}\n\t\tconst { sections, dialogIsOpen, modalText } = this.state;\n\t\tconst { otp, email, otp_enabled } = this.props.user;\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{!isMobile && (\n\t\t\t\t\t<IconTitle\n\t\t\t\t\t\ttext={STRINGS.ACCOUNTS.TAB_SECURITY}\n\t\t\t\t\t\ttextType=\"title\"\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<Accordion sections={sections} ref={this.setRef} />\n\t\t\t\t<Dialog\n\t\t\t\t\tisOpen={dialogIsOpen && !otp.requesting}\n\t\t\t\t\tlabel=\"security-modal\"\n\t\t\t\t\tonCloseDialog={this.onCloseDialog}\n\t\t\t\t\tshowCloseText={!(otp.error || modalText)}\n\t\t\t\t\ttheme={this.props.activeTheme}\n\t\t\t\t>\n\t\t\t\t\t{dialogIsOpen && !otp.requesting ? (\n\t\t\t\t\t\tthis.renderModalContent(otp, otp_enabled, email, modalText)\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div />\n\t\t\t\t\t)}\n\t\t\t\t</Dialog>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nconst mapStateToProps = (state) => ({\n\tuser: state.user,\n\tactiveLanguage: state.app.language,\n\tactiveTheme: state.app.theme\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n\trequestOTP: () => dispatch(otpRequest()),\n\totpSetActivated: (active) => dispatch(otpSetActivated(active))\n});\n\nexport default connect(\n\tmapStateToProps,\n\tmapDispatchToProps\n)(UserVerification);\n"]},"metadata":{},"sourceType":"module"}