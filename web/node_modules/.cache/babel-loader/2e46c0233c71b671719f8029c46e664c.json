{"ast":null,"code":"import _objectSpread from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/user/Documents/projects/hollaex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/user/Documents/projects/hollaex/src/containers/Trade/components/OrderEntry.js\";\nimport React, { Component } from 'react';\nimport classnames from 'classnames';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { formValueSelector, submit, change } from 'redux-form';\nimport mathjs from 'mathjs';\nimport Review from './OrderEntryReview';\nimport Form, { FORM_NAME } from './OrderEntryForm';\nimport { toFixed, formatNumber, formatBaseAmount, roundNumber, calculatePrice, calculateBalancePrice } from '../../../utils/currency';\nimport { getDecimals, playBackgroundAudioNotification } from '../../../utils/utils';\nimport { evaluateOrder, required, minValue, maxValue, checkMarketPrice, step, normalizeFloat } from '../../../components/Form/validations';\nimport { Loader } from '../../../components';\nimport { takerFee, DEFAULT_COIN_DATA } from '../../../config/constants';\nimport STRINGS from '../../../config/localizedStrings';\nimport { isLoggedIn } from '../../../utils/token';\n\nvar OrderEntry =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(OrderEntry, _Component);\n\n  function OrderEntry() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, OrderEntry);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(OrderEntry)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      formValues: {},\n      initialValues: {\n        side: STRINGS.SIDES[0].value,\n        type: STRINGS.TYPES[1].value\n      },\n      orderPrice: 0,\n      orderFees: 0,\n      outsideFormError: '',\n      totalAssets: ''\n    };\n\n    _this.calculateSections = function (_ref) {\n      var balance = _ref.balance,\n          prices = _ref.prices;\n      var totalAssets = calculateBalancePrice(balance, prices);\n\n      _this.setState({\n        totalAssets: totalAssets\n      });\n    };\n\n    _this.setMax = function () {\n      var _this$props = _this.props,\n          side = _this$props.side,\n          balance = _this$props.balance,\n          pair_base = _this$props.pair_base,\n          min_size = _this$props.min_size,\n          pair_2 = _this$props.pair_2;\n      var size = parseFloat(_this.props.size || 0);\n      var price = parseFloat(_this.props.price || 0);\n      var maxSize = balance[\"\".concat(pair_base, \"_available\")];\n\n      if (side === 'buy') {\n        maxSize = mathjs.divide(balance[\"\".concat(pair_2, \"_available\")], price);\n      }\n\n      if (maxSize !== size) {\n        _this.props.change(FORM_NAME, 'size', roundNumber(maxSize, getDecimals(min_size)));\n      }\n    };\n\n    _this.calculateOrderPrice = function (props) {\n      var type = props.type,\n          side = props.side,\n          fees = props.fees,\n          orderLimits = props.orderLimits;\n      var size = parseFloat(props.size || 0);\n      var price = parseFloat(props.price || 0);\n      var orderPrice = 0;\n\n      if (orderLimits[_this.props.pair] && size >= orderLimits[_this.props.pair].SIZE.MIN && !(type === 'limit' && price === 0)) {\n        if (props.side === 'sell') {\n          var bids = props.bids;\n          orderPrice = checkMarketPrice(size, bids, type, side, price);\n        } else {\n          var asks = props.asks;\n          orderPrice = checkMarketPrice(size, asks, type, side, price);\n        }\n      }\n\n      var orderFees = mathjs.chain(orderPrice).multiply(fees && fees.taker_fee ? fees.taker_fee : takerFee).divide(100).done();\n      var outsideFormError = '';\n\n      if (type === 'market' && orderPrice === 0 && size >= orderLimits[_this.props.pair].SIZE.MIN) {\n        outsideFormError = STRINGS.QUICK_TRADE_ORDER_NOT_FILLED;\n      } else if (type === 'market' && side === 'buy') {\n        var values = {\n          size: size,\n          side: side,\n          type: type,\n          price: price\n        };\n        var pair_base = props.pair_base,\n            pair_2 = props.pair_2,\n            balance = props.balance;\n        outsideFormError = evaluateOrder(pair_base, pair_2, balance, values, type, side, orderPrice);\n      }\n\n      _this.setState({\n        orderPrice: orderPrice,\n        orderFees: orderFees,\n        outsideFormError: outsideFormError\n      });\n    };\n\n    _this.evaluateOrder = function (values) {\n      var side = values.side,\n          type = values.type;\n      var _this$props2 = _this.props,\n          pair_base = _this$props2.pair_base,\n          pair_2 = _this$props2.pair_2,\n          balance = _this$props2.balance;\n      return evaluateOrder(pair_base, pair_2, balance, values, type, side);\n    };\n\n    _this.onSubmit = function (values) {\n      var _this$props3 = _this.props,\n          min_size = _this$props3.min_size,\n          increment_price = _this$props3.increment_price,\n          settings = _this$props3.settings;\n\n      var order = _objectSpread({}, values, {\n        size: formatNumber(values.size, getDecimals(min_size)),\n        symbol: _this.props.pair\n      });\n\n      if (values.type === 'market') {\n        delete order.price;\n      } else if (values.price) {\n        order.price = formatNumber(values.price, getDecimals(increment_price));\n      }\n\n      return _this.props.submitOrder(order).then(function () {\n        if (values.type === 'market' && settings.audio && settings.audio.order_completed) {\n          playBackgroundAudioNotification('orderbook_market_order');\n        } // this.setState({ initialValues: values });\n\n      });\n    };\n\n    _this.onReview = function () {\n      var _this$props4 = _this.props,\n          type = _this$props4.type,\n          side = _this$props4.side,\n          price = _this$props4.price,\n          size = _this$props4.size,\n          pair_base = _this$props4.pair_base,\n          pair_2 = _this$props4.pair_2,\n          min_size = _this$props4.min_size,\n          increment_price = _this$props4.increment_price,\n          openCheckOrder = _this$props4.openCheckOrder,\n          onRiskyTrade = _this$props4.onRiskyTrade,\n          submit = _this$props4.submit,\n          _this$props4$settings = _this$props4.settings,\n          _this$props4$settings2 = _this$props4$settings.risk,\n          risk = _this$props4$settings2 === void 0 ? {} : _this$props4$settings2,\n          _this$props4$settings3 = _this$props4$settings.notification,\n          notification = _this$props4$settings3 === void 0 ? {} : _this$props4$settings3;\n      var orderTotal = mathjs.add(mathjs.fraction(_this.state.orderPrice), mathjs.fraction(_this.state.orderFees));\n      var order = {\n        type: type,\n        side: side,\n        price: price,\n        size: formatNumber(size, getDecimals(min_size)),\n        symbol: pair_base,\n        orderPrice: orderTotal,\n        orderFees: _this.state.orderFees\n      };\n      var orderPriceInBaseCoin = calculatePrice(orderTotal, _this.props.prices[pair_2]);\n      var riskyPrice = _this.state.totalAssets / 100 * risk.order_portfolio_percentage;\n\n      if (type === 'market') {\n        delete order.price;\n      } else if (price) {\n        order.price = formatNumber(price, getDecimals(increment_price));\n      }\n\n      if (notification.popup_order_confirmation) {\n        openCheckOrder(order, function () {\n          if (risk.popup_warning && riskyPrice < orderPriceInBaseCoin) {\n            order['order_portfolio_percentage'] = risk.order_portfolio_percentage;\n            onRiskyTrade(order, function () {\n              submit(FORM_NAME);\n            });\n          } else {\n            submit(FORM_NAME);\n          }\n        });\n      } else if (risk.popup_warning && riskyPrice < orderPriceInBaseCoin) {\n        order['order_portfolio_percentage'] = risk.order_portfolio_percentage;\n        onRiskyTrade(order, function () {\n          submit(FORM_NAME);\n        });\n      } else {\n        submit(FORM_NAME);\n      }\n    };\n\n    _this.generateFormValues = function () {\n      var pair = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      var buyingPair = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var priceInitialized = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var sizeInitialized = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var _this$props5 = _this.props,\n          min_size = _this$props5.min_size,\n          max_size = _this$props5.max_size,\n          increment_size = _this$props5.increment_size,\n          increment_price = _this$props5.increment_price,\n          min_price = _this$props5.min_price,\n          max_price = _this$props5.max_price,\n          coins = _this$props5.coins;\n\n      var _ref2 = coins[pair] || DEFAULT_COIN_DATA,\n          symbol = _ref2.symbol;\n\n      var buyData = coins[buyingPair] || DEFAULT_COIN_DATA;\n      var formValues = {\n        type: {\n          name: 'type',\n          type: 'tab',\n          options: STRINGS.TYPES,\n          validate: [required]\n        },\n        side: {\n          name: 'side',\n          type: 'select',\n          options: STRINGS.SIDES,\n          validate: [required]\n        },\n        size: {\n          name: 'size',\n          label: React.createElement(\"div\", {\n            style: {\n              display: 'flex'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 288\n            },\n            __self: this\n          }, STRINGS.formatString(STRINGS.STRING_WITH_PARENTHESIS, STRINGS.SIZE, React.createElement(\"div\", {\n            className: \"pointer text-uppercase blue-link\",\n            onClick: _this.setMax,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 292\n            },\n            __self: this\n          }, STRINGS.CALCULATE_MAX))),\n          type: 'number',\n          placeholder: '0.00',\n          normalize: normalizeFloat,\n          step: increment_size,\n          min: min_size,\n          max: max_size,\n          validate: [required, minValue(min_size), maxValue(max_size)],\n          currency: symbol.toUpperCase(),\n          initializeEffect: sizeInitialized,\n          parse: function parse() {\n            var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n            var decimal = getDecimals(min_size);\n            var decValue = toFixed(value);\n            var valueDecimal = getDecimals(decValue);\n            var result = value;\n\n            if (decimal < valueDecimal) {\n              result = decValue.toString().substring(0, decValue.toString().length - (valueDecimal - decimal));\n            }\n\n            return result;\n          }\n        },\n        price: {\n          name: 'price',\n          label: STRINGS.PRICE,\n          type: 'number',\n          placeholder: '0',\n          normalize: normalizeFloat,\n          step: increment_price,\n          min: min_price,\n          max: max_price,\n          validate: [required, minValue(min_price), maxValue(max_price), step(increment_price)],\n          currency: buyData.symbol.toUpperCase(),\n          initializeEffect: priceInitialized\n        }\n      };\n\n      _this.setState({\n        formValues: formValues\n      });\n    };\n\n    _this.formKeyDown = function (e) {\n      if (e.key === 'Enter' && e.shiftKey === false) {\n        e.preventDefault();\n\n        _this.onReview();\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(OrderEntry, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (this.props.pair_base) {\n        this.generateFormValues(this.props.pair);\n      }\n\n      if (this.props.user.id) {\n        this.calculateSections(this.props);\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.size !== this.props.size || nextProps.side !== this.props.side || nextProps.price !== this.props.price || nextProps.type !== this.props.type || nextProps.activeLanguage !== this.props.activeLanguage) {\n        this.calculateOrderPrice(nextProps);\n      }\n\n      if (nextProps.activeLanguage !== this.props.activeLanguage) {\n        this.generateFormValues(nextProps.pair);\n      }\n\n      if (nextProps.marketPrice && !this.state.initialValues.price) {\n        this.setState({\n          initialValues: _objectSpread({}, this.state.initialValues, {\n            price: this.props.marketPrice\n          })\n        });\n      }\n\n      if (this.props.priceInitialized !== nextProps.priceInitialized) {\n        this.generateFormValues(nextProps.pair, '', nextProps.priceInitialized);\n      }\n\n      if (this.props.sizeInitialized !== nextProps.sizeInitialized) {\n        this.generateFormValues(nextProps.pair, '', nextProps.priceInitialized, nextProps.sizeInitialized);\n      }\n\n      if (JSON.stringify(this.props.prices) !== JSON.stringify(nextProps.prices) || JSON.stringify(this.props.balance) !== JSON.stringify(nextProps.balance)) {\n        this.calculateSections(nextProps);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props6 = this.props,\n          balance = _this$props6.balance,\n          type = _this$props6.type,\n          side = _this$props6.side,\n          pair_base = _this$props6.pair_base,\n          pair_2 = _this$props6.pair_2,\n          price = _this$props6.price,\n          coins = _this$props6.coins;\n      var _this$state = this.state,\n          initialValues = _this$state.initialValues,\n          formValues = _this$state.formValues,\n          orderPrice = _this$state.orderPrice,\n          orderFees = _this$state.orderFees,\n          outsideFormError = _this$state.outsideFormError;\n      var pairBase = coins[pair_base] || DEFAULT_COIN_DATA;\n      var pairTwo = coins[pair_2] || DEFAULT_COIN_DATA;\n      var currencyName = pairBase.fullname;\n      var buyingName = pairTwo.symbol.toUpperCase();\n\n      if (isLoggedIn() && !balance.hasOwnProperty(\"\".concat(pair_2, \"_balance\"))) {\n        return React.createElement(Loader, {\n          relative: true,\n          background: false,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 371\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(\"div\", {\n        className: classnames('trade_order_entry-wrapper', 'd-flex', 'flex-column', \"order_side-selector-\".concat(side)),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 375\n        },\n        __self: this\n      }, React.createElement(Form, {\n        currencyName: currencyName,\n        evaluateOrder: this.evaluateOrder,\n        onSubmit: this.onSubmit,\n        onReview: this.onReview,\n        formValues: formValues,\n        formKeyDown: this.formKeyDown,\n        initialValues: initialValues,\n        outsideFormError: outsideFormError,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 383\n        },\n        __self: this\n      }, React.createElement(Review, {\n        price: price,\n        type: type,\n        currency: buyingName,\n        orderPrice: orderPrice,\n        fees: orderFees,\n        formatToCurrency: formatBaseAmount,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 393\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return OrderEntry;\n}(Component);\n\nvar selector = formValueSelector(FORM_NAME);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  var formValues = selector(state, 'price', 'size', 'side', 'type');\n  var _state$app$pairs$stat = state.app.pairs[state.app.pair],\n      pair_base = _state$app$pairs$stat.pair_base,\n      pair_2 = _state$app$pairs$stat.pair_2,\n      max_price = _state$app$pairs$stat.max_price,\n      max_size = _state$app$pairs$stat.max_size,\n      min_size = _state$app$pairs$stat.min_size,\n      min_price = _state$app$pairs$stat.min_price,\n      increment_size = _state$app$pairs$stat.increment_size,\n      increment_price = _state$app$pairs$stat.increment_price,\n      _state$app$pairs$stat2 = _state$app$pairs$stat.maker_fees,\n      maker_fees = _state$app$pairs$stat2 === void 0 ? {} : _state$app$pairs$stat2,\n      _state$app$pairs$stat3 = _state$app$pairs$stat.taker_fees,\n      taker_fees = _state$app$pairs$stat3 === void 0 ? {} : _state$app$pairs$stat3;\n  var feesData = {\n    maker_fee: maker_fees[state.user.verification_level],\n    taker_fee: taker_fees[state.user.verification_level]\n  };\n  return _objectSpread({}, formValues, {\n    activeLanguage: state.app.language,\n    fees: feesData,\n    feesData: feesData,\n    pair: state.app.pair,\n    pair_base: pair_base,\n    pair_2: pair_2,\n    max_price: max_price,\n    max_size: max_size,\n    min_size: min_size,\n    increment_size: increment_size,\n    min_price: min_price,\n    increment_price: increment_price,\n    orderLimits: state.app.orderLimits,\n    prices: state.orderbook.prices,\n    balance: state.user.balance,\n    user: state.user,\n    settings: state.user.settings,\n    coins: state.app.coins\n  });\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    submit: bindActionCreators(submit, dispatch),\n    change: bindActionCreators(change, dispatch)\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OrderEntry);","map":{"version":3,"sources":["/home/user/Documents/projects/hollaex/src/containers/Trade/components/OrderEntry.js"],"names":["React","Component","classnames","connect","bindActionCreators","formValueSelector","submit","change","mathjs","Review","Form","FORM_NAME","toFixed","formatNumber","formatBaseAmount","roundNumber","calculatePrice","calculateBalancePrice","getDecimals","playBackgroundAudioNotification","evaluateOrder","required","minValue","maxValue","checkMarketPrice","step","normalizeFloat","Loader","takerFee","DEFAULT_COIN_DATA","STRINGS","isLoggedIn","OrderEntry","state","formValues","initialValues","side","SIDES","value","type","TYPES","orderPrice","orderFees","outsideFormError","totalAssets","calculateSections","balance","prices","setState","setMax","props","pair_base","min_size","pair_2","size","parseFloat","price","maxSize","divide","calculateOrderPrice","fees","orderLimits","pair","SIZE","MIN","bids","asks","chain","multiply","taker_fee","done","QUICK_TRADE_ORDER_NOT_FILLED","values","onSubmit","increment_price","settings","order","symbol","submitOrder","then","audio","order_completed","onReview","openCheckOrder","onRiskyTrade","risk","notification","orderTotal","add","fraction","orderPriceInBaseCoin","riskyPrice","order_portfolio_percentage","popup_order_confirmation","popup_warning","generateFormValues","buyingPair","priceInitialized","sizeInitialized","max_size","increment_size","min_price","max_price","coins","buyData","name","options","validate","label","display","formatString","STRING_WITH_PARENTHESIS","CALCULATE_MAX","placeholder","normalize","min","max","currency","toUpperCase","initializeEffect","parse","decimal","decValue","valueDecimal","result","toString","substring","length","PRICE","formKeyDown","e","key","shiftKey","preventDefault","user","id","nextProps","activeLanguage","marketPrice","JSON","stringify","pairBase","pairTwo","currencyName","fullname","buyingName","hasOwnProperty","selector","mapStateToProps","app","pairs","maker_fees","taker_fees","feesData","maker_fee","verification_level","language","orderbook","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport classnames from 'classnames';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { formValueSelector, submit, change } from 'redux-form';\nimport mathjs from 'mathjs';\n\nimport Review from './OrderEntryReview';\nimport Form, { FORM_NAME } from './OrderEntryForm';\nimport {\n\ttoFixed,\n\tformatNumber,\n\tformatBaseAmount,\n\troundNumber,\n\tcalculatePrice,\n\tcalculateBalancePrice\n} from '../../../utils/currency';\nimport { getDecimals, playBackgroundAudioNotification } from '../../../utils/utils';\nimport {\n\tevaluateOrder,\n\trequired,\n\tminValue,\n\tmaxValue,\n\tcheckMarketPrice,\n\tstep,\n\tnormalizeFloat\n} from '../../../components/Form/validations';\nimport { Loader } from '../../../components';\nimport { takerFee, DEFAULT_COIN_DATA } from '../../../config/constants';\n\nimport STRINGS from '../../../config/localizedStrings';\nimport { isLoggedIn } from '../../../utils/token';\n\nclass OrderEntry extends Component {\n\tstate = {\n\t\tformValues: {},\n\t\tinitialValues: {\n\t\t\tside: STRINGS.SIDES[0].value,\n\t\t\ttype: STRINGS.TYPES[1].value\n\t\t},\n\t\torderPrice: 0,\n\t\torderFees: 0,\n\t\toutsideFormError: '',\n\t\ttotalAssets: ''\n\t};\n\n\tcomponentDidMount() {\n\t\tif (this.props.pair_base) {\n\t\t\tthis.generateFormValues(this.props.pair);\n\t\t}\n\t\tif (this.props.user.id) {\n\t\t\tthis.calculateSections(this.props);\n\t\t}\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif (\n\t\t\tnextProps.size !== this.props.size ||\n\t\t\tnextProps.side !== this.props.side ||\n\t\t\tnextProps.price !== this.props.price ||\n\t\t\tnextProps.type !== this.props.type ||\n\t\t\tnextProps.activeLanguage !== this.props.activeLanguage\n\t\t) {\n\t\t\tthis.calculateOrderPrice(nextProps);\n\t\t}\n\t\tif (nextProps.activeLanguage !== this.props.activeLanguage) {\n\t\t\tthis.generateFormValues(nextProps.pair);\n\t\t}\n\t\tif (nextProps.marketPrice && !this.state.initialValues.price) {\n\t\t\tthis.setState({\n\t\t\t\tinitialValues: {\n\t\t\t\t\t...this.state.initialValues,\n\t\t\t\t\tprice: this.props.marketPrice\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (this.props.priceInitialized !== nextProps.priceInitialized) {\n\t\t\tthis.generateFormValues(nextProps.pair, '', nextProps.priceInitialized);\n\t\t}\n\t\tif (this.props.sizeInitialized !== nextProps.sizeInitialized) {\n\t\t\tthis.generateFormValues(nextProps.pair, '', nextProps.priceInitialized, nextProps.sizeInitialized);\n\t\t}\n\t\tif (JSON.stringify(this.props.prices) !== JSON.stringify(nextProps.prices) ||\n\t\t\tJSON.stringify(this.props.balance) !== JSON.stringify(nextProps.balance)) {\n\t\t\tthis.calculateSections(nextProps);\n\t\t}\n\t}\n\n\tcalculateSections = ({ balance, prices }) => {\n\t\tconst totalAssets = calculateBalancePrice(balance, prices);\n\t\tthis.setState({ totalAssets });\n\t};\n\n\tsetMax = () => {\n\t\tconst { side, balance, pair_base, min_size , pair_2} = this.props;\n\t\tconst size = parseFloat(this.props.size || 0);\n\t\tconst price = parseFloat(this.props.price || 0);\n\t\tlet maxSize = balance[`${pair_base}_available`];\n\t\tif (side === 'buy') {\n\t\t\tmaxSize = mathjs.divide(balance[`${pair_2}_available`], price);\n\t\t}\n\t\tif (maxSize !== size) {\n\t\t\tthis.props.change(FORM_NAME, 'size', roundNumber(maxSize, getDecimals(min_size)));\n\t\t}\n\t};\n\n\tcalculateOrderPrice = (props) => {\n\t\tconst { type, side, fees, orderLimits } = props;\n\t\tconst size = parseFloat(props.size || 0);\n\t\tconst price = parseFloat(props.price || 0);\n\n\t\tlet orderPrice = 0;\n\t\tif (\n\t\t\torderLimits[this.props.pair] && \n\t\t\tsize >= orderLimits[this.props.pair].SIZE.MIN &&\n\t\t\t!(type === 'limit' && price === 0)\n\t\t) {\n\t\t\tif (props.side === 'sell') {\n\t\t\t\tconst { bids } = props;\n\t\t\t\torderPrice = checkMarketPrice(size, bids, type, side, price);\n\t\t\t} else {\n\t\t\t\tconst { asks } = props;\n\t\t\t\torderPrice = checkMarketPrice(size, asks, type, side, price);\n\t\t\t}\n\t\t}\n\n\t\tlet orderFees = mathjs\n\t\t\t.chain(orderPrice)\n\t\t\t.multiply(fees && fees.taker_fee ? fees.taker_fee : takerFee)\n\t\t\t.divide(100)\n\t\t\t.done();\n\t\tlet outsideFormError = '';\n\n\t\tif (\n\t\t\ttype === 'market' &&\n\t\t\torderPrice === 0 &&\n\t\t\tsize >= orderLimits[this.props.pair].SIZE.MIN\n\t\t) {\n\t\t\toutsideFormError = STRINGS.QUICK_TRADE_ORDER_NOT_FILLED;\n\t\t} else if (type === 'market' && side === 'buy') {\n\t\t\tconst values = {\n\t\t\t\tsize,\n\t\t\t\tside,\n\t\t\t\ttype,\n\t\t\t\tprice\n\t\t\t};\n\t\t\tconst { pair_base, pair_2, balance } = props;\n\n\t\t\toutsideFormError = evaluateOrder(\n\t\t\t\tpair_base,\n\t\t\t\tpair_2,\n\t\t\t\tbalance,\n\t\t\t\tvalues,\n\t\t\t\ttype,\n\t\t\t\tside,\n\t\t\t\torderPrice\n\t\t\t);\n\t\t}\n\n\t\tthis.setState({ orderPrice, orderFees, outsideFormError });\n\t};\n\n\tevaluateOrder = (values) => {\n\t\tconst { side, type } = values;\n\t\tconst { pair_base, pair_2, balance } = this.props;\n\t\treturn evaluateOrder(pair_base, pair_2, balance, values, type, side);\n\t};\n\n\tonSubmit = (values) => {\n\t\tconst { min_size, increment_price, settings } = this.props;\n\n\t\tconst order = {\n\t\t\t...values,\n\t\t\tsize: formatNumber(\n\t\t\t\tvalues.size,\n\t\t\t\tgetDecimals(min_size)\n\t\t\t),\n\t\t\tsymbol: this.props.pair\n\t\t};\n\n\t\tif (values.type === 'market') {\n\t\t\tdelete order.price;\n\t\t} else if (values.price) {\n\t\t\torder.price = formatNumber(\n\t\t\t\tvalues.price,\n\t\t\t\tgetDecimals(increment_price)\n\t\t\t);\n\t\t}\n\n\t\treturn this.props.submitOrder(order).then(() => {\n\t\t\tif (values.type === 'market'\n\t\t\t\t&& settings.audio && settings.audio.order_completed) {\n\t\t\t\tplayBackgroundAudioNotification('orderbook_market_order');\n\t\t\t}\n\t\t\t// this.setState({ initialValues: values });\n\t\t});\n\t};\n\n\tonReview = () => {\n\t\tconst {\n\t\t\t// showPopup,\n\t\t\ttype,\n\t\t\tside,\n\t\t\tprice,\n\t\t\tsize,\n\t\t\t// pair,\n\t\t\tpair_base,\n\t\t\tpair_2,\n\t\t\tmin_size,\n\t\t\tincrement_price,\n\t\t\topenCheckOrder,\n\t\t\tonRiskyTrade,\n\t\t\tsubmit,\n\t\t\tsettings: { risk = {}, notification = {} }\n\t\t} = this.props;\n\t\tconst orderTotal = mathjs.add(\n\t\t\tmathjs.fraction(this.state.orderPrice),\n\t\t\tmathjs.fraction(this.state.orderFees)\n\t\t);\n\t\tconst order = {\n\t\t\ttype,\n\t\t\tside,\n\t\t\tprice,\n\t\t\tsize: formatNumber(size, getDecimals(min_size)),\n\t\t\tsymbol: pair_base,\n\t\t\torderPrice: orderTotal,\n\t\t\torderFees: this.state.orderFees\n\t\t};\n\t\tconst orderPriceInBaseCoin = calculatePrice(orderTotal, this.props.prices[pair_2]);\n\t\tconst riskyPrice = ((this.state.totalAssets / 100) * risk.order_portfolio_percentage);\n\n\t\tif (type === 'market') {\n\t\t\tdelete order.price;\n\t\t} else if (price) {\n\t\t\torder.price = formatNumber(price, getDecimals(increment_price))\n\t\t}\n\t\tif (notification.popup_order_confirmation) {\n\t\t\topenCheckOrder(order, () => {\n\t\t\t\tif (risk.popup_warning && riskyPrice < orderPriceInBaseCoin) {\n\t\t\t\t\torder['order_portfolio_percentage'] = risk.order_portfolio_percentage\n\t\t\t\t\tonRiskyTrade(order, () => {\n\t\t\t\t\t\tsubmit(FORM_NAME);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsubmit(FORM_NAME);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (risk.popup_warning && riskyPrice < orderPriceInBaseCoin) {\n\t\t\torder['order_portfolio_percentage'] = risk.order_portfolio_percentage\n\t\t\tonRiskyTrade(order, () => {\n\t\t\t\tsubmit(FORM_NAME);\n\t\t\t});\n\t\t} else {\n\t\t\tsubmit(FORM_NAME);\n\t\t}\n\t};\n\n\tgenerateFormValues = (pair = '', buyingPair = '', priceInitialized = false, sizeInitialized = false) => {\n\t\tconst {\n\n\t\t\tmin_size,\n\t\t\tmax_size,\n\t\t\tincrement_size,\n\t\t\tincrement_price,\n\t\t\tmin_price,\n\t\t\tmax_price,\n\t\t\tcoins\n\n\t\t} = this.props;\n\t\tconst { symbol } = coins[pair] || DEFAULT_COIN_DATA;\n\t\tconst buyData = coins[buyingPair] || DEFAULT_COIN_DATA;\n\t\tconst formValues = {\n\t\t\ttype: {\n\t\t\t\tname: 'type',\n\t\t\t\ttype: 'tab',\n\t\t\t\toptions: STRINGS.TYPES,\n\t\t\t\tvalidate: [required]\n\t\t\t},\n\t\t\tside: {\n\t\t\t\tname: 'side',\n\t\t\t\ttype: 'select',\n\t\t\t\toptions: STRINGS.SIDES,\n\t\t\t\tvalidate: [required]\n\t\t\t},\n\t\t\tsize: {\n\t\t\t\tname: 'size',\n\t\t\t\tlabel: (\n\t\t\t\t\t<div style={{ display: 'flex' }}>\n\t\t\t\t\t\t{STRINGS.formatString(\n\t\t\t\t\t\t\tSTRINGS.STRING_WITH_PARENTHESIS,\n\t\t\t\t\t\t\tSTRINGS.SIZE,\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"pointer text-uppercase blue-link\"\n\t\t\t\t\t\t\t\tonClick={this.setMax}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{STRINGS.CALCULATE_MAX}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t),\n\t\t\t\ttype: 'number',\n\t\t\t\tplaceholder: '0.00',\n\t\t\t\tnormalize: normalizeFloat,\n\t\t\t\tstep: increment_size,\n\t\t\t\tmin: min_size,\n\t\t\t\tmax: max_size,\n\t\t\t\tvalidate: [\n\t\t\t\t\trequired,\n\t\t\t\t\tminValue(min_size),\n\t\t\t\t\tmaxValue(max_size)\n\t\t\t\t],\n\t\t\t\tcurrency: symbol.toUpperCase(),\n\t\t\t\tinitializeEffect: sizeInitialized,\n\t\t\t\tparse: (value = '') => {\n\t\t\t\t\tlet decimal = getDecimals(min_size);\n\t\t\t\t\tlet decValue = toFixed(value);\n\t\t\t\t\tlet valueDecimal = getDecimals(decValue);\n\n\t\t\t\t\tlet result = value;\n\t\t\t\t\tif (decimal < valueDecimal) {\n\t\t\t\t\t\tresult = decValue.toString().substring(0, (decValue.toString().length - (valueDecimal - decimal)));\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t},\n\t\t\tprice: {\n\t\t\t\tname: 'price',\n\t\t\t\tlabel: STRINGS.PRICE,\n\t\t\t\ttype: 'number',\n\t\t\t\tplaceholder: '0',\n\t\t\t\tnormalize: normalizeFloat,\n\t\t\t\tstep: increment_price,\n\t\t\t\tmin: min_price,\n\t\t\t\tmax: max_price,\n\t\t\t\tvalidate: [\n\t\t\t\t\trequired,\n\t\t\t\t\tminValue(min_price),\n\t\t\t\t\tmaxValue(max_price),\n\t\t\t\t\tstep(increment_price)\n\t\t\t\t],\n\t\t\t\tcurrency: buyData.symbol.toUpperCase(),\n\t\t\t\tinitializeEffect: priceInitialized\n\t\t\t}\n\t\t};\n\n\t\tthis.setState({ formValues });\n\t};\n\n\tformKeyDown = (e) => {\n\t\tif (e.key === 'Enter' && e.shiftKey === false) {\n\t\t\te.preventDefault();\n\t\t\tthis.onReview();\n\t\t}\n\t};\n\n\trender() {\n\t\tconst { balance, type, side, pair_base, pair_2, price, coins } = this.props;\n\t\tconst {\n\t\t\tinitialValues,\n\t\t\tformValues,\n\t\t\torderPrice,\n\t\t\torderFees,\n\t\t\toutsideFormError\n\t\t} = this.state;\n\t\tconst pairBase = coins[pair_base] || DEFAULT_COIN_DATA;\n\t\tconst pairTwo = coins[pair_2] || DEFAULT_COIN_DATA;\n\n\t\tconst currencyName = pairBase.fullname;\n\t\tconst buyingName = pairTwo.symbol.toUpperCase();\n\t\tif (isLoggedIn() && !balance.hasOwnProperty(`${pair_2}_balance`)) {\n\t\t\treturn <Loader relative={true} background={false} />;\n\t\t}\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={classnames(\n\t\t\t\t\t'trade_order_entry-wrapper',\n\t\t\t\t\t'd-flex',\n\t\t\t\t\t'flex-column',\n\t\t\t\t\t`order_side-selector-${side}`\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t<Form\n\t\t\t\t\tcurrencyName={currencyName}\n\t\t\t\t\tevaluateOrder={this.evaluateOrder}\n\t\t\t\t\tonSubmit={this.onSubmit}\n\t\t\t\t\tonReview={this.onReview}\n\t\t\t\t\tformValues={formValues}\n\t\t\t\t\tformKeyDown={this.formKeyDown}\n\t\t\t\t\tinitialValues={initialValues}\n\t\t\t\t\toutsideFormError={outsideFormError}\n\t\t\t\t>\n\t\t\t\t\t<Review\n\t\t\t\t\t\tprice={price}\n\t\t\t\t\t\ttype={type}\n\t\t\t\t\t\tcurrency={buyingName}\n\t\t\t\t\t\torderPrice={orderPrice}\n\t\t\t\t\t\tfees={orderFees}\n\t\t\t\t\t\tformatToCurrency={formatBaseAmount}\n\t\t\t\t\t/>\n\t\t\t\t</Form>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nconst selector = formValueSelector(FORM_NAME);\n\nconst mapStateToProps = (state) => {\n\tconst formValues = selector(state, 'price', 'size', 'side', 'type');\n\tconst {\n\t\tpair_base,\n\t\tpair_2,\n\t\tmax_price,\n\t\tmax_size,\n\t\tmin_size,\n\t\tmin_price,\n\t\tincrement_size,\n\t\tincrement_price,\n\t\tmaker_fees = {},\n\t\ttaker_fees = {}\n\t} = state.app.pairs[state.app.pair];\n\n\tconst feesData = {\n\t\tmaker_fee: maker_fees[state.user.verification_level],\n\t\ttaker_fee: taker_fees[state.user.verification_level]\n\t};\n\n\treturn {\n\t\t...formValues,\n\t\tactiveLanguage: state.app.language,\n\t\tfees: feesData,\n\t\tfeesData,\n\t\tpair: state.app.pair,\n\t\tpair_base,\n\t\tpair_2,\n\t\tmax_price,\n\t\tmax_size,\n\t\tmin_size,\n\t\tincrement_size,\n\t\tmin_price,\n\t\tincrement_price,\n\t\torderLimits: state.app.orderLimits,\n\t\tprices: state.orderbook.prices,\n\t\tbalance: state.user.balance,\n\t\tuser: state.user,\n\t\tsettings: state.user.settings,\n\t\tcoins: state.app.coins\n\t};\n};\n\nconst mapDispatchToProps = (dispatch) => ({\n\tsubmit: bindActionCreators(submit, dispatch),\n\tchange: bindActionCreators(change, dispatch)\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OrderEntry);\n"]},"metadata":{},"sourceType":"module"}