swagger: "2.0"
info:
  version: "2.0.0"
  title: HollaEx Kit
host: api.hollaex.com
basePath: /v1
schemes:
  - http
  - https
consumes:
  - application/json
produces:
  - application/json
  - text/csv

securityDefinitions:
  Bearer:
    description: JWT authentication
    type: apiKey
    name: Authorization
    in: header
  HmacKey:
    description: HMAC API key
    type: apiKey
    name: api-key
    in: header

paths:
  /health:
    x-swagger-router-controller: general
    get:
      operationId: getHealth
      description: Get health of server
      tags:
        - Public
      responses:
        200:
          description: Success
          schema:
            type: object
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
  /constant:
    x-swagger-router-controller: general
    get:
      operationId: getConstants
      description: Get the system constants such as pairs and currencies
      tags:
        - Public
      responses:
        200:
          description: Success
          schema:
            type: object
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
  /signup:
    x-swagger-router-controller: user
    post:
      operationId: signUpUser
      description: User sign up
      tags:
        - Public
      parameters:
        - name: signup
          in: body
          required: true
          schema:
            $ref: "#/definitions/UserAuthentication"
      responses:
        201:
          description: Created
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
  /verify:
    x-swagger-router-controller: user
    get:
      operationId: getVerifyUser
      description: Get information of verification user, must provide email or verification_code. If you want to resend the email, provide email and resend query parameters
      tags:
        - Public
      parameters:
        - name: email
          in: query
          description: User's email
          required: false
          type: string
        - name: resend
          in: query
          description: Resend email to user
          required: false
          type: boolean
        - name: verification_code
          in: query
          description: Verification code
          required: false
          type: string
      responses:
        200:
          description: Success
          schema:
            type: object
            properties:
              verification_code:
                type: string
              email:
                type: string
              message:
                type: string
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
    post:
      operationId: verifyUser
      description: User Verification
      tags:
        - Public
      parameters:
        - name: data
          in: body
          required: true
          schema:
            type: object
            required:
              - email
              - verification_code
            properties:
              email:
                type: string
              verification_code:
                type: string
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
  /login:
    x-swagger-router-controller: user
    post:
      operationId: loginPost
      description: Login with a particular role. If OTP is enabled, the user must provide an OTP code
      tags:
        - Public
      parameters:
        - name: authentication
          in: body
          required: true
          schema:
            $ref: "#/definitions/UserAuthentication"
      responses:
        200:
          description: Success
          schema:
            type: object
            properties:
              token:
                type: string
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
  /verify-token:
    x-swagger-router-controller: user
    get:
      operationId: verifyToken
      description: Verify token
      tags:
        - Public
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /reset-password:
    x-swagger-router-controller: user
    get:
      operationId: requestResetPassword
      description: Request a code to reset password of a user
      tags:
        - Public
      parameters:
        - name: email
          in: query
          required: true
          type: string
        - name: captcha
          in: query
          required: false
          type: string
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
    post:
      operationId: resetPassword
      description: "Reset password of a user"
      tags:
        - Public
      parameters:
        - name: data
          in: body
          required: true
          schema:
            $ref: "#/definitions/ResetPassword"
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
  /user:
    x-swagger-router-controller: user
    get:
      operationId: getUser
      description: List information of authenticated user
      tags:
        - User
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/UserResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/settings:
    x-swagger-router-controller: user
    put:
      operationId: updateSettings
      description: Edit settings of authenticated user
      tags:
        - User
      parameters:
        - name: data
          in: body
          required: true
          schema:
            $ref: "#/definitions/SettingsPut"
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/UserResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/change-password:
    x-swagger-router-controller: user
    post:
      operationId: changePassword
      description: Change password of authenticated user
      tags:
        - User
      parameters:
        - name: data
          in: body
          required: true
          schema:
            $ref: "#/definitions/ChangePassword"
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/username:
    x-swagger-router-controller: user
    post:
      operationId: setUsername
      description: Change user's username
      tags:
        - User
      parameters:
        - name: data
          in: body
          required: true
          schema:
            type: object
            required:
              - username
            properties:
              username:
                type: string
                minLength: 3
                maxLength: 15
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/logins:
    x-swagger-router-controller: user
    get:
      operationId: getUserLogins
      description: List logins of authenticated user
      tags:
        - User
      parameters:
        - in: query
          name: limit
          description: "Number of elements to return. Default: 50. Maximun: 100"
          required: false
          type: number
          format: int32
        - in: query
          name: page
          description: Page of data to  retrieve
          required: false
          type: number
          format: int32
        - in: query
          name: start_date
          description: Starting date of queried data
          required: false
          type: string
          format: date-time
        - in: query
          name: end_date
          description: Ending date of queried data
          required: false
          type: string
          format: date-time
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/LoginsResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/affiliation:
    x-swagger-router-controller: user
    get:
      operationId: affiliationCount
      description: Get the number of affiliated account a user has made
      tags:
        - User
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/CountResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/request-withdrawal:
    x-swagger-router-controller: withdrawals
    post:
      operationId: requestWithdrawal
      description: This will send a confirmation email to the email address on record, if activate OTP, it will require OTP as well.
      tags:
        - User
        - Withdraw
      parameters:
        - name: data
          description: withdrawal information
          in: body
          required: true
          schema:
            $ref: "#/definitions/WithdrawalRequest"
      responses:
        200:
          description: Success
          schema:
            type: object
            properties:
              message:
                type: string
              transaction_id:
                type: string
              fee:
                type: string
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/request-otp:
    x-swagger-router-controller: otp
    get:
      operationId: requestOtp
      description: Generate OTP code for OTP verification
      tags:
        - User
        - OTP
      responses:
        200:
          description: Created
          schema:
            type: object
            required:
              - secret
            properties:
              secret:
                type: string
        403:
          description: Access Denied
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/activate-otp:
    x-swagger-router-controller: otp
    post:
      operationId: activateOtp
      description: Enable OTP
      parameters:
        - name: data
          description: Activation code
          in: body
          required: true
          schema:
            $ref: "#/definitions/OtpRequest"
      tags:
        - User
        - OTP
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        403:
          description: Access Denied
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /user/deactivate-otp:
    x-swagger-router-controller: otp
    post:
      operationId: deactivateOtp
      description: Disable OTP
      tags:
        - User
        - OTP
      parameters:
        - name: data
          description: Activation code
          in: body
          required: true
          schema:
            $ref: "#/definitions/OtpRequest"
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        403:
          description: Access Denied
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  # Plugin Endpoints
  /plugins:
    x-swagger-router-controller: plugins
    get:
      operationId: getPlugins
      description: Get all plugins constants
      tags:
        - Plugins
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitionsObjectResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
  /plugins/activate-xht-fee:
    x-swagger-router-controller: plugins
    get:
      operationId: activeXhtFee
      description: Activate xht fee
      tags:
        - Plugins
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /plugins/bank/user:
    x-swagger-router-controller: plugins
    post:
      operationId: postBankUser
      description: Add a new bank for a user
      parameters:
        - name: data
          in: body
          required: true
          description: Bank information
          schema:
            $ref: "#/definitions/BankObject"
      tags:
        - Plugins
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/BankArray"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /plugins/bank/admin:
    x-swagger-router-controller: plugins
    post:
      operationId: postBankAdmin
      description: Update a user's bank information
      parameters:
        - name: id
          in: query
          required: true
          description: User id to add bank to
          type: number
          format: int32
        - name: data
          in: body
          required: true
          description: Bank information
          schema:
            type: object
            required:
              - bank_account
            properties:
              bank_account:
                $ref: "#/definitions/BankArray"
      tags:
        - Plugins
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/BankArray"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - supervisor
        - support
        - kyc
  /plugins/bank/verify:
    x-swagger-router-controller: plugins
    post:
      operationId: bankVerify
      description: Verify a user's bank information
      parameters:
        - name: data
          in: body
          required: true
          description: User and bank id
          schema:
            type: object
            required:
              - user_id
              - bank_id
            properties:
              user_id:
                type: number
                format: int32
              bank_id:
                type: number
                format: int32
      tags:
        - Plugins
      responses:
        200:
          description: Success
          schema:
            type: object
            properties:
              bank_account:
                $ref: "#/definitions/BankArray"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - supervisor
        - support
        - kyc
  /plugins/bank/revoke:
    x-swagger-router-controller: plugins
    post:
      operationId: bankRevoke
      description: Revoke a user's bank information
      parameters:
        - name: data
          in: body
          required: true
          description: User and bank id
          schema:
            type: object
            required:
              - user_id
              - bank_id
              - message
            properties:
              user_id:
                type: number
                format: int32
              bank_id:
                type: number
                format: int32
              message:
                type: string
      tags:
        - Plugins
      responses:
        200:
          description: Success
          schema:
            type: object
            properties:
              bank_account:
                $ref: "#/definitions/BankArray"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - supervisor
        - support
        - kyc
  /plugins/kyc/user:
    x-swagger-router-controller: plugins
    put:
      operationId: putKycUser
      description: Update user kyc info
      tags:
        - Plugins
      parameters:
        - name: data
          in: body
          required: true
          schema:
            $ref: "#/definitions/UserPut"
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/UserResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /plugins/kyc/admin:
    x-swagger-router-controller: plugins
    put:
      operationId: putKycAdmin
      description: Admin update user kyc info
      tags:
        - Plugins
      parameters:
        - name: user_id
          in: query
          required: true
          description: User Id to update info for
        - name: data
          in: body
          required: true
          schema:
            $ref: "#/definitions/UserPut"
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/UserResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - supervisor
        - support
  /plugins/kyc/user/upload:
    x-swagger-router-controller: plugins
    post:
      operationId: kycUserUpload
      description: Upload user id images. They must have a mime type of image. The max size of the 3 files together is 10 MB. If the call excedes the size, nginx will return a 413 error.
      tags:
        - Plugins
      consumes:
        - multipart/form-data
      parameters:
        - name: front
          description: Image of the front of user's id
          in: formData
          required: true
          type: files
        - name: back
          description: Image of the back of user's id
          in: formData
          required: false
          type: file
        - name: proof_of_residency
          description: Image of the user's proof of residency
          in: formData
          required: false
          type: file
        - name: type
          description: Type of the id document
          in: formData
          required: false
          type: string
        - name: number
          description: Number of the id document
          in: formData
          required: false
          format: string
        - name: expiration_date
          description: Expiration date of the document
          in: formData
          required: false
          type: string
          format: date-time
        - name: issued_date
          description: Issue date of the document
          in: formData
          required: false
          type: string
          format: date-time
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        413:
          description: Entity too large
          schema:
            type: string
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - user
  /plugins/kyc/admin/upload:
    x-swagger-router-controller: plugins
    post:
      operationId: kycAdminUpload
      description: Admin upload user id images. They must have a mime type of image. The max size of the 3 files together is 10 MB. If the call excedes the size, nginx will return a 413 error.
      tags:
        - Plugins
      consumes:
        - multipart/form-data
      parameters:
        - name: user_id
          in: query
          description: Id of user to upload document for
          required: true
          type: number
          format: int32
        - name: front
          description: Image of the front of user's id
          in: formData
          required: true
          type: files
        - name: back
          description: Image of the back of user's id
          in: formData
          required: false
          type: file
        - name: proof_of_residency
          description: Image of the user's proof of residency
          in: formData
          required: false
          type: file
        - name: type
          description: Type of the id document
          in: formData
          required: false
          type: string
        - name: number
          description: Number of the id document
          in: formData
          required: false
          format: string
        - name: expiration_date
          description: Expiration date of the document
          in: formData
          required: false
          type: string
          format: date-time
        - name: issued_date
          description: Issue date of the document
          in: formData
          required: false
          type: string
          format: date-time
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/MessageResponse"
        413:
          description: Entity too large
          schema:
            type: string
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - supervisor
  /plugins/kyc/id:
    x-swagger-router-controller: plugins
    get:
      operationId: getKycId
      description: Admin upload user id images. They must have a mime type of image. The max size of the 3 files together is 10 MB. If the call excedes the size, nginx will return a 413 error.
      tags:
        - Plugins
      parameters:
        - name: email
          in: query
          description: Email of user to get image for
          required: false
          type: string
        - name: id
          in: query
          description: Id of user to get image for
          required: false
          type: number
          format: int32
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/VerificationId"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - supervisor
        - support
        - kyc
  /plugins/kyc/id/verify:
    x-swagger-router-controller: plugins
    post:
      operationId: kycIdVerify
      description: Verify a user's id documents
      tags:
        - Plugins
      parameters:
        - name: data
          in: body
          required: true
          schema:
            type: object
            required:
              - user_id
            properties:
              user_id:
                type: number
                format: int32
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/UserResponse"
        default:
          description: Error
          schema:
            $ref: "#/definitions/MessageResponse"
      security:
        - Bearer: []
      x-security-scopes:
        - admin
        - supervisor
        - support
        - kyc


definitions:
  ObjectResponse:
    type: object
  MessageResponse:
    required:
      - message
    properties:
      message:
        type: string
  UserAuthentication:
    type: object
    required:
      - email
      - password
    properties:
      email:
        type: string
      password:
        type: string
        format: password
      otp_code:
        type: string
      captcha:
        type: string
      referral:
        type: string
      service:
        type: string
  ResetPassword:
    type: object
    required:
      - code
      - new_password
    properties:
      new_password:
        type: string
      code:
        type: string
  UserResponse:
    type: object
    properties:
      id:
        type: number
      email:
        type: string
      full_name:
        type: string
      gender:
        type: boolean
      nationality:
        type: string
      address:
        type: object
        properties:
          country:
            type: string
          address:
            type: string
          postal_code:
            type: string
          city:
            type: string
          verified:
            type: boolean
      phone_number:
        type: string
      id_data:
        type: object
        properties:
          type:
            type: string
          number:
            type: string
          issued_date:
            type: string
          expiration_date:
            type: string
          verified:
            type: boolean
      bank_account:
        $ref: "#/definitions/BankArray"
      crypto_wallet:
        type: object
      verification_level:
        type: number
      settings:
        type: object
        properties:
          language:
            type: string
            default: 'en'
            maxLength: 3
            minLength: 2
  SettingsPut:
    type: object
    properties:
      language:
        type: string
        default: 'en'
        maxLength: 3
        minLength: 2
      risk:
        type: object
        properties:
          popup_warning:
            type: boolean
          order_portfolio_percentage:
            type: number
            format: int32
            minimum: 1
            maximum: 99
      audio:
        type: object
        properties:
          putblic_trade:
            type: boolean
          order_completed:
            type: boolean
          order_partially_completed:
            type: boolean
      interface:
        type: object
        properties:
          theme:
            type: string
          order_book_levels:
            type: number
            format: int32
            minimum: 1
            maximum: 20
      notification:
        type: object
        properties:
          popup_order_completed:
            type: boolean
          popup_order_confirmation:
            type: boolean
          popup_order_partially_filled:
            type: boolean
  UserPut:
    type: object
    properties:
      full_name:
        type: string
      gender:
        type: boolean
      nationality:
        type: string
      dob:
        type: string
        format: date-time
      address:
        type: object
        required:
          - country
          - address
          - postal_code
          - city
        properties:
          country:
            type: string
          address:
            type: string
          postal_code:
            type: string
          city:
            type: string
      phone_number:
        type: string
  ChangePassword:
    type: object
    required:
      - old_password
      - new_password
    properties:
      old_password:
        type: string
      new_password:
        type: string
  LoginsResponse:
    type: object
    properties:
      count:
        type: number
        format: int32
      data:
        type: array
        items:
          type: object
          properties:
            ip:
              type: string
            device:
              type: string
            domain:
              type: string
            timestamp:
              type: string
              format: date-time
  CountResponse:
    required:
      - count
    properties:
      count:
        type: number
  WithdrawalRequest:
    type: object
    required:
      - address
      - amount
      - currency
    properties:
      address:
        type: string
        description: Destination address
      currency:
        type: string
        description: currency to be withdrawn (btc, eth, etc)
      amount:
        type: number
        format: double
        description: Amount to transfer (in btc, eth, bch)
      captcha:
        type: string
        description: captcha token
      otp_code:
        type: string
        description: OTP code when otp is enabled
        minLength: 6
        maxLength: 6
  OtpRequest:
    type: object
    required:
      - code
    properties:
      code:
        type: string
  BankObject:
    type: object
    properties:
      bank_name:
        type: string
      account_number:
        type: string
        maxLength: 50
      card_number:
        type: string
  BankArray:
    type: array
      items:
        $ref: "#/definitions/BankObject"
  VerificationId:
    type: object
    required:
      - front
    properties:
      front:
        type: string
      back:
        type: string
      proof_of_residency:
        type: string